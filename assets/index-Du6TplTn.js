var F=Object.defineProperty;var T=(r,t,e)=>t in r?F(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var s=(r,t,e)=>(T(r,typeof t!="symbol"?t+"":t,e),e);import{L as w,F as b,S as Y,V as k,G as O,T as f,U as R,K as I,R as A}from"./Text-C7Rb6x9P.js";import{I as p,f as l,C as G,g as V,G as n}from"./Utils-BbtiyQYk.js";class W{constructor(t,e){s(this,"startNode");s(this,"endNode");s(this,"startID");s(this,"endID");s(this,"endX");s(this,"endY");s(this,"width");s(this,"simulator");s(this,"line");s(this,"_value");s(this,"_destroyed");this.startNode=e,this.endNode=null,this.startID=e.id,this.endID=null,this.simulator=t,this.endX=0,this.endY=0,this.width=8,this._destroyed=!1,this.Value=this.startNode.value}destroy(){this._destroyed||(this._destroyed=!0,this.startNode.InputState=p.FREE,this.endNode&&(this.endNode.Value=!1,this.endNode.InputState=p.FREE),this.startNode=null,this.endNode=null)}generateNodeValue(){this._destroyed||(this.startNode.isOutput&&this.endNode.isOutput||!this.startNode.isOutput&&!this.endNode.isOutput?(this.startNode.Value=this.startNode.Value||this.endNode.Value,this.endNode.Value=this.startNode.Value):this.endNode&&(this.endNode.Value=this.startNode.Value))}getStartNode(){return this.startNode}updateEnd(t,e){this.endX=t,this.endY=e}setEndNode(t){if(!this._destroyed){if(t.isOutput){let e=this.startNode;this.startNode=t,this.endNode=e,this.endNode.InputState=p.TAKEN}else this.endNode=t,this.startNode.InputState=p.TAKEN,this.endNode.InputState=p.TAKEN;if(this.startID=this.startNode.id,this.endID=this.endNode.id,this.line)this.line.points(this._generateLinePoints());else{this.line=new w({stroke:"black",strokeWidth:this.width/2,points:this._generateLinePoints()}),this.simulator._layer.add(this.line);const e=this.startNode;e.subscribe(this.endNode),this.Value=this.startNode.Value,e.subscribe(this)}}}get Value(){return this._value}set Value(t){this._value=t,this.line&&this.line.stroke(this._value?l(!0):"black")}_generateLinePoints(){var t,e,i,a;return[((t=this.startNode)==null?void 0:t.posX)||0,((e=this.startNode)==null?void 0:e.posY)||0,((i=this.endNode)==null?void 0:i.posX)||0,((a=this.endNode)==null?void 0:a.posY)||0]}}class E{constructor(t){s(this,"wire");s(this,"shortCircuit");s(this,"isOpened");s(this,"simulator");this.wire=[],this.shortCircuit=[],this.isOpened=!1,this.simulator=t}addNode(t){var e,i;if(!this.isOpened)this.wire.push(new W(this.simulator,t)),this.isOpened=!0;else{let a=this.wire.length-1;t!=this.wire[a].getStartNode()&&(((e=this.wire[a].getStartNode())==null?void 0:e.isOutput)!=t.isOutput||t.Brother==this.wire[a].getStartNode())?t==((i=this.wire[a].getStartNode())==null?void 0:i.Brother)?this.wire.length--:this.wire[a].setEndNode(t):this.wire.length--,this.isOpened=!1}}destroy(){for(let t of this.wire)t.destroy();this.wire.length=0,this.simulator=null}}var N={};Object.defineProperty(N,"__esModule",{value:!0});var y=N.Circle=void 0;const C=b,U=Y,H=k,B=O;class c extends U.Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}y=N.Circle=c;c.prototype._centroid=!0;c.prototype.className="Circle";c.prototype._attrsAffectingSize=["radius"];(0,B._registerNode)(c);C.Factory.addGetterSetter(c,"radius",0,(0,H.getNumberValidator)());class z{constructor(){s(this,"currentID");s(this,"nodeList");this.currentID=0,this.nodeList=[]}}class D{constructor(t,e,i,a=!1,h=!1){s(this,"diameter");s(this,"value");s(this,"posX");s(this,"posY");s(this,"isOutput");s(this,"hitRange");s(this,"inputState");s(this,"isAlive");s(this,"brotherNode");s(this,"id");s(this,"nodeManager");s(this,"circle");this.nodeManager=t.nodeManager,this.diameter=10,this.value=h,this.posX=e,this.posY=i,this.isOutput=a,this.hitRange=this.diameter+10,this.inputState=p.FREE,this.isAlive=!0,this.brotherNode=null,this.id=this.nodeManager.currentID++,this.nodeManager.nodeList[this.id]=this;const u=t._layer;this.circle=new y({x:this.posX,y:this.posY,fill:l(this.value),radius:this.diameter/2,stroke:"black",strokeWidth:4}),this.circle.on("mouseover",()=>{this.circle.fill("#80808080")}),this.circle.on("mouseout",()=>{this.circle.fill(l(this.value))}),u.add(this.circle)}destroy(){this.isAlive=!1,this.nodeManager.nodeList[this.id]=void 0}draw(){}set ID(t){this.nodeManager.nodeList[this.id]=void 0,this.id=t,this.nodeManager.nodeList[this.id]=this,this.id>this.nodeManager.currentID&&(this.nodeManager.currentID=this.id+1)}set InputState(t){this.inputState=t}set Brother(t){this.brotherNode=t}get Brother(){return this.brotherNode}get Value(){return this.value}set Value(t){this.value=t,this.circle.fill(l(this.value)),this.circle.stroke(this.value?l(this.value):"black")}updatePosition(t,e){this.posX=t,this.posY=e,this.circle.x(this.posX),this.circle.y(this.posY)}}class m extends D{constructor(e,i,a,h=!1,u){super(e,i,a,!1,h);s(this,"_callback");this._callback=u}get Value(){return super.Value}set Value(e){super.Value=e,typeof this._callback=="function"&&this._callback(this.value)}}class P extends D{constructor(e,i,a,h=!1){super(e,i,a,!0,h);s(this,"_subscribers");this._subscribers=[]}get Value(){return super.Value}set Value(e){super.Value=e;for(const i of this._subscribers)i.Value=e}subscribe(e){this._subscribers.push(e)}destroy(){this._subscribers.length=0}}class ${constructor(t,e={}){s(this,"value");s(this,"posX");s(this,"posY");s(this,"diameter");s(this,"isSpawned");s(this,"isMoving");s(this,"offsetMouseX");s(this,"offsetMouseY");s(this,"output");s(this,"nodeStartID");s(this,"circle");s(this,"line");s(this,"txt_value");s(this,"txt_label");this.value=e.value==1||!1,this.posX=typeof e.posX=="number"?e.posX:0,this.posY=typeof e.posY=="number"?e.posY:0,this.diameter=typeof e.diameter=="number"?e.diameter:25,this.isSpawned=typeof e.isSpawned=="boolean"?e.isSpawned:!1,this.isMoving=e.isMoving||!1,this.offsetMouseX=typeof e.offsetMouseX=="number"?e.offsetMouseX:0,this.offsetMouseY=typeof e.offsetMouseY=="number"?e.offsetMouseY:0,this.output=new P(t,this.posX+30,this.posY,this.value),this.nodeStartID=typeof e.nodeStartID=="number"?e.nodeStartID:this.output.id;const i=t._layer;this.circle=new y({x:this.posX,y:this.posY,radius:this.diameter/2,fill:l(this.value),stroke:"black",strokeWidth:4}),this.circle.on("click",()=>{this.toggle()}),i.add(this.circle),this.line=new w({points:this._generateLinePoints(),strokeWidth:4,stroke:"black"}),i.add(this.line);const a=this.TextLabelPos;this.txt_label=new f({x:a.x,y:a.y,text:"INPUT",fontSize:12}),i.add(this.txt_label);const h=this.TextValuePos;this.txt_value=new f({x:h.x,y:h.y,text:this.value?"1":"0",fontSize:18,fontStyle:this.value?"bold":"normal",fill:this.value?"black":"white"}),this.txt_value.on("click",()=>{this.toggle()}),i.add(this.txt_value)}destroy(){var t;(t=this.output)==null||t.destroy(),this.output=void 0}refreshNodes(){this.output&&(this.output.ID=this.nodeStartID)}get TextValuePos(){return{x:this.posX-this.diameter/4,y:this.posY-this.diameter/4}}get TextLabelPos(){return{x:this.posX-20,y:this.posY+this.diameter}}_generateLinePoints(){var t;return[this.posX+this.diameter/2,this.posY,this.posX+30-(((t=this.output)==null?void 0:t.diameter)||0)/2,this.posY]}toggle(){this.value=!this.value,this.circle.fill(l(this.value)),this.line.stroke(this.value?l(this.value):"black"),this.output&&(this.output.Value=this.value),this.value?(this.txt_value.text("1"),this.txt_value.fontStyle("bold"),this.txt_value.fill("black")):(this.txt_value.text("0"),this.txt_value.fontStyle("normal"),this.txt_value.fill("white"))}}class K{constructor(t,e={}){s(this,"value");s(this,"posX");s(this,"posY");s(this,"diameter");s(this,"isSpawned");s(this,"isMoving");s(this,"offsetMouseX");s(this,"offsetMouseY");s(this,"input");s(this,"nodeStartID");s(this,"line");s(this,"circle");s(this,"txt_value");s(this,"txt_label");this.value=e.value==!0,this.posX=typeof e.posX=="number"?e.posX:0,this.posY=typeof e.posY=="number"?e.posY:0,this.diameter=typeof e.diameter=="number"?e.diameter:25,this.isSpawned=typeof e.isSpawned=="boolean"?e.isSpawned:!1,this.isMoving=e.isMoving||!1,this.offsetMouseX=typeof e.offsetMouseX=="number"?e.offsetMouseX:0,this.offsetMouseY=typeof e.offsetMouseY=="number"?e.offsetMouseY:0,this.input=new m(t,this.posX-30,this.posY,this.value,u=>{this._update(u)}),this.nodeStartID=typeof e.nodeStartID=="number"?e.nodeStartID:this.input.id;const i=t._layer;this.circle=new y({x:this.posX,y:this.posY,radius:this.diameter/2,fill:l(this.value),stroke:"black",strokeWidth:4}),i.add(this.circle),this.line=new w({points:this._generateLinePoints(),strokeWidth:4,stroke:"black"}),i.add(this.line);const a=this.TextLabelPos;this.txt_label=new f({x:a.x,y:a.y,text:"OUTPUT",fontSize:12}),i.add(this.txt_label);const h=this.TextValuePos;this.txt_value=new f({x:h.x,y:h.y,text:this.value?"1":"0",fontSize:18,fontStyle:this.value?"bold":"normal",fill:this.value?"black":"white"}),i.add(this.txt_value)}destroy(){var t;(t=this.input)==null||t.destroy(),this.input=void 0}_update(t){this.value=t,this.circle.fill(l(this.value)),this.line.stroke(this.value?l(this.value):"black"),this.value?(this.txt_value.text("1"),this.txt_value.fontStyle("bold"),this.txt_value.fill("black")):(this.txt_value.text("0"),this.txt_value.fontStyle("normal"),this.txt_value.fill("white"))}refreshNodes(){this.input&&(this.input.ID=this.nodeStartID)}get TextValuePos(){return{x:this.posX-this.diameter/4,y:this.posY-this.diameter/4}}get TextLabelPos(){return{x:this.posX-20,y:this.posY+this.diameter}}_generateLinePoints(){var t;return[this.posX-this.diameter/2,this.posY,this.posX-30+(((t=this.input)==null?void 0:t.diameter)||0)/2,this.posY]}}var S={};Object.defineProperty(S,"__esModule",{value:!0});var L=S.Image=void 0;const _=R,d=b,q=Y,J=O,g=k;class o extends q.Shape{constructor(t){super(t),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&t.readyState===4||t&&t.addEventListener&&t.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),i=this.getHeight(),a=this.cornerRadius(),h=this.attrs.image;let u;if(h){const x=this.attrs.cropWidth,M=this.attrs.cropHeight;x&&M?u=[h,this.cropX(),this.cropY(),x,M,0,0,e,i]:u=[h,0,0,e,i]}(this.hasFill()||this.hasStroke()||a)&&(t.beginPath(),a?_.Util.drawRoundedRectPath(t,e,i,a):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)),h&&(a&&t.clip(),t.drawImage.apply(t,u))}_hitFunc(t){var e=this.width(),i=this.height(),a=this.cornerRadius();t.beginPath(),a?_.Util.drawRoundedRectPath(t,e,i,a):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return(t=this.attrs.width)!==null&&t!==void 0?t:(e=this.image())===null||e===void 0?void 0:e.width}getHeight(){var t,e;return(t=this.attrs.height)!==null&&t!==void 0?t:(e=this.image())===null||e===void 0?void 0:e.height}static fromURL(t,e,i=null){var a=_.Util.createImageElement();a.onload=function(){var h=new o({image:a});e(h)},a.onerror=i,a.crossOrigin="Anonymous",a.src=t}}L=S.Image=o;o.prototype.className="Image";(0,J._registerNode)(o);d.Factory.addGetterSetter(o,"cornerRadius",0,(0,g.getNumberOrArrayOfNumbersValidator)(4));d.Factory.addGetterSetter(o,"image");d.Factory.addComponentsGetterSetter(o,"crop",["x","y","width","height"]);d.Factory.addGetterSetter(o,"cropX",0,(0,g.getNumberValidator)());d.Factory.addGetterSetter(o,"cropY",0,(0,g.getNumberValidator)());d.Factory.addGetterSetter(o,"cropWidth",0,(0,g.getNumberValidator)());d.Factory.addGetterSetter(o,"cropHeight",0,(0,g.getNumberValidator)());class Q{constructor(t,e={}){s(this,"strType");s(this,"type");s(this,"width");s(this,"height");s(this,"posX");s(this,"posY");s(this,"isSpawned");s(this,"offsetMouseX");s(this,"offsetMouseY");s(this,"isMoving");s(this,"input");s(this,"output");s(this,"nodeStartID");s(this,"_image");s(this,"text");s(this,"image");if(this.strType=typeof e.strType=="string"?e.strType:"AND",this.type=G(this.strType),!V.has(this.type)){const a="Images are not intialized";throw new Error(a)}this._image=V.get(this.type),this.width=this._image.width,this.height=this._image.height,this.posX=typeof e.posX=="number"?e.posX:0,this.posY=typeof e.posY=="number"?e.posY:0,this.image=new L({x:this.posX,y:this.posY,image:this._image,width:this.width,height:this.height}),t._layer.add(this.image);const i=12;this.text=new f({x:this.posX+this.width/4+12,y:this.posY+this.height,text:this.strType,fontSize:i}),t._layer.add(this.text),this.isSpawned=typeof e.isSpawned=="boolean"?e.isSpawned:!1,this.offsetMouseX=typeof e.offsetMouseX=="number"?e.offsetMouseX:0,this.offsetMouseY=typeof e.offsetMouseY=="number"?e.offsetMouseY:0,this.isMoving=typeof e.isMoving=="boolean"?e.isMoving:!1,this.input=[],this.input.push(new m(t,this.posX,this.posY+(this.type==n.NOT?this.height/2:15),!1,()=>{this.generateOutput()})),this.type!=n.NOT&&(this.input.push(new m(t,this.posX,this.posY+this.height-15,!1,()=>{this.generateOutput()})),this.input[0].Brother=this.input[1],this.input[1].Brother=this.input[0]),this.output=new P(t,this.posX+this.width,this.posY+this.height/2),this.output.Value=this.calculateValue(),this.nodeStartID=typeof e.nodeStartID=="number"?e.nodeStartID:this.input[0].id}destroy(){var t,e;for(let i=0;i<this.input.length;i++)(t=this.input[i])==null||t.destroy(),this.input[i]=void 0;(e=this.output)==null||e.destroy(),this.output=void 0}refreshNodes(){let t=this.nodeStartID;for(let e=0;e<this.input.length;e++)this.input[e]!=null&&(this.input[e].ID=t,t++);this.output&&(this.output.ID=t)}generateOutput(){this.output&&(this.output.Value=this.calculateValue())}calculateValue(){switch(this.type){case n.NOT:return!this.input[0].Value;case n.AND:return this.input[0].Value&&this.input[1].Value;case n.NAND:return!(this.input[0].Value&&this.input[1].Value);case n.OR:return this.input[0].Value||this.input[1].Value;case n.NOR:return!(this.input[0].Value||this.input[1].Value);case n.XOR:return this.input[0].Value!=this.input[1].Value;case n.XNOR:return this.input[0].Value==this.input[1].Value;default:return!1}}}function X(r){return typeof r=="string"||r instanceof String}function v(r,t){if(r!=null&&t.key in r&&Array.isArray(r[t.key])){t.target.length=0;const e=r[t.key];for(let i=0;i<e.length;i++){let a=e[i];if(a==null)break;const h=t.func(a);t.target.push(h),h.refreshNodes()}}}class Z{constructor(t){s(this,"simulator");this.simulator=t}loadFile_ex(t){try{const e=X(t)?JSON.parse(t):t;if(v(e,{key:"logicInput",target:this.simulator.logicInput,func:i=>new $(this.simulator,i)}),v(e,{key:"logicOutput",target:this.simulator.logicOutput,func:i=>new K(this.simulator,i)}),v(e,{key:"gate",target:this.simulator.gate,func:i=>new Q(this.simulator,i)}),"wire"in e&&Array.isArray(e.wire)){const i=e.wire;for(let a of i){if(a==null)break;this.simulator.wireMng.addNode(this.simulator.nodeManager.nodeList[a.startID]),this.simulator.wireMng.addNode(this.simulator.nodeManager.nodeList[a.endID])}}}catch(e){console.error(e)}}loadFile(t){const e=t.target;if(e.files&&e.files.length>0){const i=new FileReader;i.onload=()=>{const a=i.result;X(a)&&this.loadFile_ex(a)},i.readAsText(e.files[0])}}}class st{constructor(t,e){s(this,"logicInput");s(this,"logicOutput");s(this,"gate");s(this,"wireMng");s(this,"fileManager");s(this,"nodeManager");s(this,"_layer");s(this,"_stage");this._stage=new I.Stage({container:t,height:t.offsetHeight,width:t.offsetWidth}),this._layer=new I.Layer,this._stage.add(this._layer);const i=new A({x:0,y:0,width:t.offsetWidth,height:t.offsetHeight,fill:"white"});this._layer.add(i),this.logicInput=[],this.logicOutput=[],this.gate=[],this.nodeManager=new z,this.wireMng=new E(this),this.fileManager=new Z(this),this.loadFile_ex(e)}loadFile(t){this.fileManager.loadFile(t)}loadFile_ex(t){this.fileManager.loadFile_ex(t)}destroy(){this.wireMng.destroy(),this.wireMng=null,this.fileManager=null;for(let t of this.logicInput)t.destroy();this.logicInput.length=0;for(let t of this.gate)t.destroy();this.gate.length=0;for(let t of this.logicOutput)t.destroy();this.logicOutput.length=0,this._stage.destroy()}}export{st as S};
