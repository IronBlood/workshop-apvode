import{T as Ce,U as qe}from"./vendor-70biTZpe.js";var he={exports:{}},le={},z={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s._registerNode=s.Konva=s.glob=void 0;const t=Math.PI/180;function e(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}s.glob=typeof Ce<"u"?Ce:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},s.Konva={_global:s.glob,version:"9.3.6",isBrowser:e(),isUnminified:/param/.test((function(r){}).toString()),dblClickWindow:400,getAngle(r){return s.Konva.angleDeg?r*t:r},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return s.Konva.DD.isDragging},isTransforming(){var r;return(r=s.Konva.Transformer)===null||r===void 0?void 0:r.isTransforming()},isDragReady(){return!!s.Konva.DD.node},releaseCanvasOnDestroy:!0,document:s.glob.document,_injectGlobal(r){s.glob.Konva=r}};const i=r=>{s.Konva[r.prototype.getClassName()]=r};s._registerNode=i,s.Konva._injectGlobal(s.Konva)})(z);var tt={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Util=s.Transform=void 0;const t=z;class e{constructor(h=[1,0,0,1,0,0]){this.dirty=!1,this.m=h&&h.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new e(this.m)}copyInto(h){h.m[0]=this.m[0],h.m[1]=this.m[1],h.m[2]=this.m[2],h.m[3]=this.m[3],h.m[4]=this.m[4],h.m[5]=this.m[5]}point(h){var f=this.m;return{x:f[0]*h.x+f[2]*h.y+f[4],y:f[1]*h.x+f[3]*h.y+f[5]}}translate(h,f){return this.m[4]+=this.m[0]*h+this.m[2]*f,this.m[5]+=this.m[1]*h+this.m[3]*f,this}scale(h,f){return this.m[0]*=h,this.m[1]*=h,this.m[2]*=f,this.m[3]*=f,this}rotate(h){var f=Math.cos(h),y=Math.sin(h),x=this.m[0]*f+this.m[2]*y,c=this.m[1]*f+this.m[3]*y,E=this.m[0]*-y+this.m[2]*f,_=this.m[1]*-y+this.m[3]*f;return this.m[0]=x,this.m[1]=c,this.m[2]=E,this.m[3]=_,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(h,f){var y=this.m[0]+this.m[2]*f,x=this.m[1]+this.m[3]*f,c=this.m[2]+this.m[0]*h,E=this.m[3]+this.m[1]*h;return this.m[0]=y,this.m[1]=x,this.m[2]=c,this.m[3]=E,this}multiply(h){var f=this.m[0]*h.m[0]+this.m[2]*h.m[1],y=this.m[1]*h.m[0]+this.m[3]*h.m[1],x=this.m[0]*h.m[2]+this.m[2]*h.m[3],c=this.m[1]*h.m[2]+this.m[3]*h.m[3],E=this.m[0]*h.m[4]+this.m[2]*h.m[5]+this.m[4],_=this.m[1]*h.m[4]+this.m[3]*h.m[5]+this.m[5];return this.m[0]=f,this.m[1]=y,this.m[2]=x,this.m[3]=c,this.m[4]=E,this.m[5]=_,this}invert(){var h=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),f=this.m[3]*h,y=-this.m[1]*h,x=-this.m[2]*h,c=this.m[0]*h,E=h*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),_=h*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=f,this.m[1]=y,this.m[2]=x,this.m[3]=c,this.m[4]=E,this.m[5]=_,this}getMatrix(){return this.m}decompose(){var h=this.m[0],f=this.m[1],y=this.m[2],x=this.m[3],c=this.m[4],E=this.m[5],_=h*x-f*y;let P={x:c,y:E,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(h!=0||f!=0){var G=Math.sqrt(h*h+f*f);P.rotation=f>0?Math.acos(h/G):-Math.acos(h/G),P.scaleX=G,P.scaleY=_/G,P.skewX=(h*y+f*x)/_,P.skewY=0}else if(y!=0||x!=0){var k=Math.sqrt(y*y+x*x);P.rotation=Math.PI/2-(x>0?Math.acos(-y/k):-Math.acos(y/k)),P.scaleX=_/k,P.scaleY=k,P.skewX=0,P.skewY=(h*y+f*x)/_}return P.rotation=s.Util._getRotation(P.rotation),P}}s.Transform=e;var i="[object Array]",r="[object Number]",a="[object String]",o="[object Boolean]",l=Math.PI/180,u=180/Math.PI,v="#",b="",R="0",A="Konva warning: ",p="Konva error: ",g="rgb(",m={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},S=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,C=[];const T=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(n){setTimeout(n,60)};s.Util={_isElement(n){return!!(n&&n.nodeType==1)},_isFunction(n){return!!(n&&n.constructor&&n.call&&n.apply)},_isPlainObject(n){return!!n&&n.constructor===Object},_isArray(n){return Object.prototype.toString.call(n)===i},_isNumber(n){return Object.prototype.toString.call(n)===r&&!isNaN(n)&&isFinite(n)},_isString(n){return Object.prototype.toString.call(n)===a},_isBoolean(n){return Object.prototype.toString.call(n)===o},isObject(n){return n instanceof Object},isValidSelector(n){if(typeof n!="string")return!1;var h=n[0];return h==="#"||h==="."||h===h.toUpperCase()},_sign(n){return n===0||n>0?1:-1},requestAnimFrame(n){C.push(n),C.length===1&&T(function(){const h=C;C=[],h.forEach(function(f){f()})})},createCanvasElement(){var n=document.createElement("canvas");try{n.style=n.style||{}}catch{}return n},createImageElement(){return document.createElement("img")},_isInDocument(n){for(;n=n.parentNode;)if(n==document)return!0;return!1},_urlToImage(n,h){var f=s.Util.createImageElement();f.onload=function(){h(f)},f.src=n},_rgbToHex(n,h,f){return((1<<24)+(n<<16)+(h<<8)+f).toString(16).slice(1)},_hexToRgb(n){n=n.replace(v,b);var h=parseInt(n,16);return{r:h>>16&255,g:h>>8&255,b:h&255}},getRandomColor(){for(var n=(Math.random()*16777215<<0).toString(16);n.length<6;)n=R+n;return v+n},getRGB(n){var h;return n in m?(h=m[n],{r:h[0],g:h[1],b:h[2]}):n[0]===v?this._hexToRgb(n.substring(1)):n.substr(0,4)===g?(h=S.exec(n.replace(/ /g,"")),{r:parseInt(h[1],10),g:parseInt(h[2],10),b:parseInt(h[3],10)}):{r:0,g:0,b:0}},colorToRGBA(n){return n=n||"black",s.Util._namedColorToRBA(n)||s.Util._hex3ColorToRGBA(n)||s.Util._hex4ColorToRGBA(n)||s.Util._hex6ColorToRGBA(n)||s.Util._hex8ColorToRGBA(n)||s.Util._rgbColorToRGBA(n)||s.Util._rgbaColorToRGBA(n)||s.Util._hslColorToRGBA(n)},_namedColorToRBA(n){var h=m[n.toLowerCase()];return h?{r:h[0],g:h[1],b:h[2],a:1}:null},_rgbColorToRGBA(n){if(n.indexOf("rgb(")===0){n=n.match(/rgb\(([^)]+)\)/)[1];var h=n.split(/ *, */).map(Number);return{r:h[0],g:h[1],b:h[2],a:1}}},_rgbaColorToRGBA(n){if(n.indexOf("rgba(")===0){n=n.match(/rgba\(([^)]+)\)/)[1];var h=n.split(/ *, */).map((f,y)=>f.slice(-1)==="%"?y===3?parseInt(f)/100:parseInt(f)/100*255:Number(f));return{r:h[0],g:h[1],b:h[2],a:h[3]}}},_hex8ColorToRGBA(n){if(n[0]==="#"&&n.length===9)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:parseInt(n.slice(7,9),16)/255}},_hex6ColorToRGBA(n){if(n[0]==="#"&&n.length===7)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:1}},_hex4ColorToRGBA(n){if(n[0]==="#"&&n.length===5)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:parseInt(n[4]+n[4],16)/255}},_hex3ColorToRGBA(n){if(n[0]==="#"&&n.length===4)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:1}},_hslColorToRGBA(n){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(n)){const[h,...f]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(n),y=Number(f[0])/360,x=Number(f[1])/100,c=Number(f[2])/100;let E,_,P;if(x===0)return P=c*255,{r:Math.round(P),g:Math.round(P),b:Math.round(P),a:1};c<.5?E=c*(1+x):E=c+x-c*x;const G=2*c-E,k=[0,0,0];for(let L=0;L<3;L++)_=y+1/3*-(L-1),_<0&&_++,_>1&&_--,6*_<1?P=G+(E-G)*6*_:2*_<1?P=E:3*_<2?P=G+(E-G)*(2/3-_)*6:P=G,k[L]=P*255;return{r:Math.round(k[0]),g:Math.round(k[1]),b:Math.round(k[2]),a:1}}},haveIntersection(n,h){return!(h.x>n.x+n.width||h.x+h.width<n.x||h.y>n.y+n.height||h.y+h.height<n.y)},cloneObject(n){var h={};for(var f in n)this._isPlainObject(n[f])?h[f]=this.cloneObject(n[f]):this._isArray(n[f])?h[f]=this.cloneArray(n[f]):h[f]=n[f];return h},cloneArray(n){return n.slice(0)},degToRad(n){return n*l},radToDeg(n){return n*u},_degToRad(n){return s.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),s.Util.degToRad(n)},_radToDeg(n){return s.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),s.Util.radToDeg(n)},_getRotation(n){return t.Konva.angleDeg?s.Util.radToDeg(n):n},_capitalize(n){return n.charAt(0).toUpperCase()+n.slice(1)},throw(n){throw new Error(p+n)},error(n){console.error(p+n)},warn(n){t.Konva.showWarnings&&console.warn(A+n)},each(n,h){for(var f in n)h(f,n[f])},_inRange(n,h,f){return h<=n&&n<f},_getProjectionToSegment(n,h,f,y,x,c){var E,_,P,G=(n-f)*(n-f)+(h-y)*(h-y);if(G==0)E=n,_=h,P=(x-f)*(x-f)+(c-y)*(c-y);else{var k=((x-n)*(f-n)+(c-h)*(y-h))/G;k<0?(E=n,_=h,P=(n-x)*(n-x)+(h-c)*(h-c)):k>1?(E=f,_=y,P=(f-x)*(f-x)+(y-c)*(y-c)):(E=n+k*(f-n),_=h+k*(y-h),P=(E-x)*(E-x)+(_-c)*(_-c))}return[E,_,P]},_getProjectionToLine(n,h,f){var y=s.Util.cloneObject(n),x=Number.MAX_VALUE;return h.forEach(function(c,E){if(!(!f&&E===h.length-1)){var _=h[(E+1)%h.length],P=s.Util._getProjectionToSegment(c.x,c.y,_.x,_.y,n.x,n.y),G=P[0],k=P[1],L=P[2];L<x&&(y.x=G,y.y=k,x=L)}}),y},_prepareArrayForTween(n,h,f){var y,x=[],c=[];if(n.length>h.length){var E=h;h=n,n=E}for(y=0;y<n.length;y+=2)x.push({x:n[y],y:n[y+1]});for(y=0;y<h.length;y+=2)c.push({x:h[y],y:h[y+1]});var _=[];return c.forEach(function(P){var G=s.Util._getProjectionToLine(P,x,f);_.push(G.x),_.push(G.y)}),_},_prepareToStringify(n){var h;n.visitedByCircularReferenceRemoval=!0;for(var f in n)if(n.hasOwnProperty(f)&&n[f]&&typeof n[f]=="object"){if(h=Object.getOwnPropertyDescriptor(n,f),n[f].visitedByCircularReferenceRemoval||s.Util._isElement(n[f]))if(h.configurable)delete n[f];else return null;else if(s.Util._prepareToStringify(n[f])===null)if(h.configurable)delete n[f];else return null}return delete n.visitedByCircularReferenceRemoval,n},_assign(n,h){for(var f in h)n[f]=h[f];return n},_getFirstPointerId(n){return n.touches?n.changedTouches[0].identifier:n.pointerId||999},releaseCanvas(...n){t.Konva.releaseCanvasOnDestroy&&n.forEach(h=>{h.width=0,h.height=0})},drawRoundedRectPath(n,h,f,y){let x=0,c=0,E=0,_=0;typeof y=="number"?x=c=E=_=Math.min(y,h/2,f/2):(x=Math.min(y[0]||0,h/2,f/2),c=Math.min(y[1]||0,h/2,f/2),_=Math.min(y[2]||0,h/2,f/2),E=Math.min(y[3]||0,h/2,f/2)),n.moveTo(x,0),n.lineTo(h-c,0),n.arc(h-c,c,c,Math.PI*3/2,0,!1),n.lineTo(h,f-_),n.arc(h-_,f-_,_,0,Math.PI/2,!1),n.lineTo(E,f),n.arc(E,f-E,E,Math.PI/2,Math.PI,!1),n.lineTo(0,x),n.arc(x,x,x,Math.PI,Math.PI*3/2,!1)}}})(tt);var St={},dt={},N={};Object.defineProperty(N,"__esModule",{value:!0});N.getComponentValidator=N.getBooleanValidator=N.getNumberArrayValidator=N.getFunctionValidator=N.getStringOrGradientValidator=N.getStringValidator=N.getNumberOrAutoValidator=N.getNumberOrArrayOfNumbersValidator=N.getNumberValidator=N.alphaComponent=N.RGBComponent=void 0;const vt=z,Y=tt;function _t(s){return Y.Util._isString(s)?'"'+s+'"':Object.prototype.toString.call(s)==="[object Number]"||Y.Util._isBoolean(s)?s:Object.prototype.toString.call(s)}function Je(s){return s>255?255:s<0?0:Math.round(s)}N.RGBComponent=Je;function Ze(s){return s>1?1:s<1e-4?1e-4:s}N.alphaComponent=Ze;function Qe(){if(vt.Konva.isUnminified)return function(s,t){return Y.Util._isNumber(s)||Y.Util.warn(_t(s)+' is a not valid value for "'+t+'" attribute. The value should be a number.'),s}}N.getNumberValidator=Qe;function ti(s){if(vt.Konva.isUnminified)return function(t,e){let i=Y.Util._isNumber(t),r=Y.Util._isArray(t)&&t.length==s;return!i&&!r&&Y.Util.warn(_t(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or Array<number>('+s+")"),t}}N.getNumberOrArrayOfNumbersValidator=ti;function ei(){if(vt.Konva.isUnminified)return function(s,t){var e=Y.Util._isNumber(s),i=s==="auto";return e||i||Y.Util.warn(_t(s)+' is a not valid value for "'+t+'" attribute. The value should be a number or "auto".'),s}}N.getNumberOrAutoValidator=ei;function ii(){if(vt.Konva.isUnminified)return function(s,t){return Y.Util._isString(s)||Y.Util.warn(_t(s)+' is a not valid value for "'+t+'" attribute. The value should be a string.'),s}}N.getStringValidator=ii;function ri(){if(vt.Konva.isUnminified)return function(s,t){const e=Y.Util._isString(s),i=Object.prototype.toString.call(s)==="[object CanvasGradient]"||s&&s.addColorStop;return e||i||Y.Util.warn(_t(s)+' is a not valid value for "'+t+'" attribute. The value should be a string or a native gradient.'),s}}N.getStringOrGradientValidator=ri;function ai(){if(vt.Konva.isUnminified)return function(s,t){return Y.Util._isFunction(s)||Y.Util.warn(_t(s)+' is a not valid value for "'+t+'" attribute. The value should be a function.'),s}}N.getFunctionValidator=ai;function ni(){if(vt.Konva.isUnminified)return function(s,t){const e=Int8Array?Object.getPrototypeOf(Int8Array):null;return e&&s instanceof e||(Y.Util._isArray(s)?s.forEach(function(i){Y.Util._isNumber(i)||Y.Util.warn('"'+t+'" attribute has non numeric element '+i+". Make sure that all elements are numbers.")}):Y.Util.warn(_t(s)+' is a not valid value for "'+t+'" attribute. The value should be a array of numbers.')),s}}N.getNumberArrayValidator=ni;function si(){if(vt.Konva.isUnminified)return function(s,t){var e=s===!0||s===!1;return e||Y.Util.warn(_t(s)+' is a not valid value for "'+t+'" attribute. The value should be a boolean.'),s}}N.getBooleanValidator=si;function oi(s){if(vt.Konva.isUnminified)return function(t,e){return t==null||Y.Util.isObject(t)||Y.Util.warn(_t(t)+' is a not valid value for "'+e+'" attribute. The value should be an object with properties '+s),t}}N.getComponentValidator=oi;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Factory=void 0;const t=tt,e=N;var i="get",r="set";s.Factory={addGetterSetter(a,o,l,u,v){s.Factory.addGetter(a,o,l),s.Factory.addSetter(a,o,u,v),s.Factory.addOverloadedGetterSetter(a,o)},addGetter(a,o,l){var u=i+t.Util._capitalize(o);a.prototype[u]=a.prototype[u]||function(){var v=this.attrs[o];return v===void 0?l:v}},addSetter(a,o,l,u){var v=r+t.Util._capitalize(o);a.prototype[v]||s.Factory.overWriteSetter(a,o,l,u)},overWriteSetter(a,o,l,u){var v=r+t.Util._capitalize(o);a.prototype[v]=function(b){return l&&b!==void 0&&b!==null&&(b=l.call(this,b,o)),this._setAttr(o,b),u&&u.call(this),this}},addComponentsGetterSetter(a,o,l,u,v){var b=l.length,R=t.Util._capitalize,A=i+R(o),p=r+R(o),g,m;a.prototype[A]=function(){var C={};for(g=0;g<b;g++)m=l[g],C[m]=this.getAttr(o+R(m));return C};var S=(0,e.getComponentValidator)(l);a.prototype[p]=function(C){var T=this.attrs[o],n;u&&(C=u.call(this,C)),S&&S.call(this,C,o);for(n in C)C.hasOwnProperty(n)&&this._setAttr(o+R(n),C[n]);return C||l.forEach(h=>{this._setAttr(o+R(h),void 0)}),this._fireChangeEvent(o,T,C),v&&v.call(this),this},s.Factory.addOverloadedGetterSetter(a,o)},addOverloadedGetterSetter(a,o){var l=t.Util._capitalize(o),u=r+l,v=i+l;a.prototype[o]=function(){return arguments.length?(this[u](arguments[0]),this):this[v]()}},addDeprecatedGetterSetter(a,o,l,u){t.Util.error("Adding deprecated "+o);var v=i+t.Util._capitalize(o),b=o+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[v]=function(){t.Util.error(b);var R=this.attrs[o];return R===void 0?l:R},s.Factory.addSetter(a,o,u,function(){t.Util.error(b)}),s.Factory.addOverloadedGetterSetter(a,o)},backCompat(a,o){t.Util.each(o,function(l,u){var v=a.prototype[u],b=i+t.Util._capitalize(l),R=r+t.Util._capitalize(l);function A(){v.apply(this,arguments),t.Util.error('"'+l+'" method is deprecated and will be removed soon. Use ""'+u+'" instead.')}a.prototype[l]=A,a.prototype[b]=A,a.prototype[R]=A})},afterSetFilter(){this._filterUpToDate=!1}}})(dt);var ht={},pt={};Object.defineProperty(pt,"__esModule",{value:!0});pt.HitContext=pt.SceneContext=pt.Context=void 0;const Ue=tt,hi=z;function li(s){var t=[],e=s.length,i=Ue.Util,r,a;for(r=0;r<e;r++)a=s[r],i._isNumber(a)?a=Math.round(a*1e3)/1e3:i._isString(a)||(a=a+""),t.push(a);return t}var Se=",",di="(",ci=")",ui="([",fi="])",gi=";",pi="()",vi="=",be=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],_i=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const mi=100;class jt{constructor(t){this.canvas=t,hi.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){var i=this.traceArr,r=i.length,a="",o,l,u,v;for(o=0;o<r;o++)l=i[o],u=l.method,u?(v=l.args,a+=u,t?a+=pi:Ue.Util._isArray(v[0])?a+=ui+v.join(Se)+fi:(e&&(v=v.map(b=>typeof b=="number"?Math.floor(b):b)),a+=di+v.join(Se)+ci)):(a+=l.property,t||(a+=vi+l.val)),a+=gi;return a}clearTrace(){this.traceArr=[]}_trace(t){var e=this.traceArr,i;e.push(t),i=e.length,i>=mi&&e.shift()}reset(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){var e=t.getAbsoluteOpacity();e!==1&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,i,r,a,o){this._context.arc(t,e,i,r,a,o)}arcTo(t,e,i,r,a){this._context.arcTo(t,e,i,r,a)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,i,r,a,o){this._context.bezierCurveTo(t,e,i,r,a,o)}clearRect(t,e,i,r){this._context.clearRect(t,e,i,r)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){var i=arguments;if(i.length===2)return this._context.createImageData(t,e);if(i.length===1)return this._context.createImageData(t)}createLinearGradient(t,e,i,r){return this._context.createLinearGradient(t,e,i,r)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,i,r,a,o){return this._context.createRadialGradient(t,e,i,r,a,o)}drawImage(t,e,i,r,a,o,l,u,v){var b=arguments,R=this._context;b.length===3?R.drawImage(t,e,i):b.length===5?R.drawImage(t,e,i,r,a):b.length===9&&R.drawImage(t,e,i,r,a,o,l,u,v)}ellipse(t,e,i,r,a,o,l,u){this._context.ellipse(t,e,i,r,a,o,l,u)}isPointInPath(t,e,i,r){return i?this._context.isPointInPath(i,t,e,r):this._context.isPointInPath(t,e,r)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,i,r){this._context.fillRect(t,e,i,r)}strokeRect(t,e,i,r){this._context.strokeRect(t,e,i,r)}fillText(t,e,i,r){r?this._context.fillText(t,e,i,r):this._context.fillText(t,e,i)}measureText(t){return this._context.measureText(t)}getImageData(t,e,i,r){return this._context.getImageData(t,e,i,r)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,i,r){this._context.rect(t,e,i,r)}roundRect(t,e,i,r,a){this._context.roundRect(t,e,i,r,a)}putImageData(t,e,i){this._context.putImageData(t,e,i)}quadraticCurveTo(t,e,i,r){this._context.quadraticCurveTo(t,e,i,r)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,i,r,a,o){this._context.setTransform(t,e,i,r,a,o)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,i,r){this._context.strokeText(t,e,i,r)}transform(t,e,i,r,a,o){this._context.transform(t,e,i,r,a,o)}translate(t,e){this._context.translate(t,e)}_enableTrace(){var t=this,e=be.length,i=this.setAttr,r,a,o=function(l){var u=t[l],v;t[l]=function(){return a=li(Array.prototype.slice.call(arguments,0)),v=u.apply(t,arguments),t._trace({method:l,args:a}),v}};for(r=0;r<e;r++)o(be[r]);t.setAttr=function(){i.apply(t,arguments);var l=arguments[0],u=arguments[1];(l==="shadowOffsetX"||l==="shadowOffsetY"||l==="shadowBlur")&&(u=u/this.canvas.getPixelRatio()),t._trace({property:l,val:u})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;var i=!e||e==="source-over";i||this.setAttr("globalCompositeOperation",e)}}pt.Context=jt;_i.forEach(function(s){Object.defineProperty(jt.prototype,s,{get(){return this._context[s]},set(t){this._context[s]=t}})});class yi extends jt{constructor(t,{willReadFrequently:e=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),i=t.getFillPriority();if(e&&i==="color"){this._fillColor(t);return}const r=t.getFillPatternImage();if(r&&i==="pattern"){this._fillPattern(t);return}const a=t.getFillLinearGradientColorStops();if(a&&i==="linear-gradient"){this._fillLinearGradient(t);return}const o=t.getFillRadialGradientColorStops();if(o&&i==="radial-gradient"){this._fillRadialGradient(t);return}e?this._fillColor(t):r?this._fillPattern(t):a?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),i=t.getStrokeLinearGradientEndPoint(),r=t.getStrokeLinearGradientColorStops(),a=this.createLinearGradient(e.x,e.y,i.x,i.y);if(r){for(var o=0;o<r.length;o+=2)a.addColorStop(r[o],r[o+1]);this.setAttr("strokeStyle",a)}}_stroke(t){var e=t.dash(),i=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!i){this.save();var r=this.getCanvas().getPixelRatio();this.setTransform(r,0,0,r,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var a=t.getStrokeLinearGradientColorStops();a?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),i||this.restore()}}_applyShadow(t){var e,i,r,a=(e=t.getShadowRGBA())!==null&&e!==void 0?e:"black",o=(i=t.getShadowBlur())!==null&&i!==void 0?i:5,l=(r=t.getShadowOffset())!==null&&r!==void 0?r:{x:0,y:0},u=t.getAbsoluteScale(),v=this.canvas.getPixelRatio(),b=u.x*v,R=u.y*v;this.setAttr("shadowColor",a),this.setAttr("shadowBlur",o*Math.min(Math.abs(b),Math.abs(R))),this.setAttr("shadowOffsetX",l.x*b),this.setAttr("shadowOffsetY",l.y*R)}}pt.SceneContext=yi;class Ci extends jt{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const a=t.getStrokeScaleEnabled();if(!a){this.save();var e=this.getCanvas().getPixelRatio();this.setTransform(e,0,0,e,0,0)}this._applyLineCap(t);var i=t.hitStrokeWidth(),r=i==="auto"?t.strokeWidth():i;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),a||this.restore()}}}pt.HitContext=Ci;Object.defineProperty(ht,"__esModule",{value:!0});ht.HitCanvas=ht.SceneCanvas=ht.Canvas=void 0;const zt=tt,Ne=pt,Ie=z,Si=dt,bi=N;var Vt;function wi(){if(Vt)return Vt;var s=zt.Util.createCanvasElement(),t=s.getContext("2d");return Vt=function(){var e=Ie.Konva._global.devicePixelRatio||1,i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e/i}(),zt.Util.releaseCanvas(s),Vt}class $t{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=t||{},i=e.pixelRatio||Ie.Konva.pixelRatio||wi();this.pixelRatio=i,this._canvas=zt.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio,i=this.getContext()._context;i.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio,i=this.getContext()._context;i.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch{try{return this._canvas.toDataURL()}catch(r){return zt.Util.error("Unable to get data URL. "+r.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}ht.Canvas=$t;Si.Factory.addGetterSetter($t,"pixelRatio",void 0,(0,bi.getNumberValidator)());class Pi extends $t{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new Ne.SceneContext(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}ht.SceneCanvas=Pi;class Ti extends $t{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new Ne.HitContext(this),this.setSize(t.width,t.height)}}ht.HitCanvas=Ti;var qt={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.DD=void 0;const t=z,e=tt;s.DD={get isDragging(){var i=!1;return s.DD._dragElements.forEach(r=>{r.dragStatus==="dragging"&&(i=!0)}),i},justDragged:!1,get node(){var i;return s.DD._dragElements.forEach(r=>{i=r.node}),i},_dragElements:new Map,_drag(i){const r=[];s.DD._dragElements.forEach((a,o)=>{const{node:l}=a,u=l.getStage();u.setPointersPositions(i),a.pointerId===void 0&&(a.pointerId=e.Util._getFirstPointerId(i));const v=u._changedPointerPositions.find(A=>A.id===a.pointerId);if(v){if(a.dragStatus!=="dragging"){var b=l.dragDistance(),R=Math.max(Math.abs(v.x-a.startPointerPos.x),Math.abs(v.y-a.startPointerPos.y));if(R<b||(l.startDrag({evt:i}),!l.isDragging()))return}l._setDragPosition(i,a),r.push(l)}}),r.forEach(a=>{a.fire("dragmove",{type:"dragmove",target:a,evt:i},!0)})},_endDragBefore(i){const r=[];s.DD._dragElements.forEach(a=>{const{node:o}=a,l=o.getStage();if(i&&l.setPointersPositions(i),!l._changedPointerPositions.find(b=>b.id===a.pointerId))return;(a.dragStatus==="dragging"||a.dragStatus==="stopped")&&(s.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,a.dragStatus="stopped");const v=a.node.getLayer()||a.node instanceof t.Konva.Stage&&a.node;v&&r.indexOf(v)===-1&&r.push(v)}),r.forEach(a=>{a.draw()})},_endDragAfter(i){s.DD._dragElements.forEach((r,a)=>{r.dragStatus==="stopped"&&r.node.fire("dragend",{type:"dragend",target:r.node,evt:i},!0),r.dragStatus!=="dragging"&&s.DD._dragElements.delete(a)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",s.DD._endDragBefore,!0),window.addEventListener("touchend",s.DD._endDragBefore,!0),window.addEventListener("mousemove",s.DD._drag),window.addEventListener("touchmove",s.DD._drag),window.addEventListener("mouseup",s.DD._endDragAfter,!1),window.addEventListener("touchend",s.DD._endDragAfter,!1))})(qt);Object.defineProperty(St,"__esModule",{value:!0});St.Node=void 0;const U=tt,It=dt,Ft=ht,yt=z,ot=qt,j=N;var Xt="absoluteOpacity",Ht="allEventListeners",gt="absoluteTransform",we="absoluteScale",Pt="canvas",Ei="Change",xi="children",Ai="konva",de="listening",Pe="mouseenter",Te="mouseleave",Ee="set",xe="Shape",Wt=" ",Ae="stage",Ct="transform",ki="Stage",ce="visible",Di=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Wt);let Ri=1;class F{constructor(t){this._id=Ri++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){(t===Ct||t===gt)&&this._cache.get(t)?this._cache.get(t).dirty=!0:t?this._cache.delete(t):this._cache.clear()}_getCache(t,e){var i=this._cache.get(t),r=t===Ct||t===gt,a=i===void 0||r&&i.dirty===!0;return a&&(i=e.call(this),this._cache.set(t,i)),i}_calculate(t,e,i){if(!this._attachedDepsListeners.get(t)){const r=e.map(a=>a+"Change.konva").join(Wt);this.on(r,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,i)}_getCanvasCache(){return this._cache.get(Pt)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===gt&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Pt)){const{scene:t,filter:e,hit:i}=this._cache.get(Pt);U.Util.releaseCanvas(t,e,i),this._cache.delete(Pt)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){var e=t||{},i={};(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)&&(i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));var r=Math.ceil(e.width||i.width),a=Math.ceil(e.height||i.height),o=e.pixelRatio,l=e.x===void 0?Math.floor(i.x):e.x,u=e.y===void 0?Math.floor(i.y):e.y,v=e.offset||0,b=e.drawBorder||!1,R=e.hitCanvasPixelRatio||1;if(!r||!a){U.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const A=Math.abs(Math.round(i.x)-l)>.5?1:0,p=Math.abs(Math.round(i.y)-u)>.5?1:0;r+=v*2+A,a+=v*2+p,l-=v,u-=v;var g=new Ft.SceneCanvas({pixelRatio:o,width:r,height:a}),m=new Ft.SceneCanvas({pixelRatio:o,width:0,height:0,willReadFrequently:!0}),S=new Ft.HitCanvas({pixelRatio:R,width:r,height:a}),C=g.getContext(),T=S.getContext();return S.isCache=!0,g.isCache=!0,this._cache.delete(Pt),this._filterUpToDate=!1,e.imageSmoothingEnabled===!1&&(g.getContext()._context.imageSmoothingEnabled=!1,m.getContext()._context.imageSmoothingEnabled=!1),C.save(),T.save(),C.translate(-l,-u),T.translate(-l,-u),this._isUnderCache=!0,this._clearSelfAndDescendantCache(Xt),this._clearSelfAndDescendantCache(we),this.drawScene(g,this),this.drawHit(S,this),this._isUnderCache=!1,C.restore(),T.restore(),b&&(C.save(),C.beginPath(),C.rect(0,0,r,a),C.closePath(),C.setAttr("strokeStyle","red"),C.setAttr("lineWidth",5),C.stroke(),C.restore()),this._cache.set(Pt,{scene:g,filter:m,hit:S,x:l,y:u}),this._requestDraw(),this}isCached(){return this._cache.has(Pt)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){var i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],r=1/0,a=1/0,o=-1/0,l=-1/0,u=this.getAbsoluteTransform(e);return i.forEach(function(v){var b=u.point(v);r===void 0&&(r=o=b.x,a=l=b.y),r=Math.min(r,b.x),a=Math.min(a,b.y),o=Math.max(o,b.x),l=Math.max(l,b.y)}),{x:r,y:a,width:o-r,height:l-a}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);var i=this._getCachedSceneCanvas(),r=i.pixelRatio;t.drawImage(i._canvas,0,0,i.width/r,i.height/r),t.restore()}_drawCachedHitCanvas(t){var e=this._getCanvasCache(),i=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(i._canvas,0,0,i.width/i.pixelRatio,i.height/i.pixelRatio),t.restore()}_getCachedSceneCanvas(){var t=this.filters(),e=this._getCanvasCache(),i=e.scene,r=e.filter,a=r.getContext(),o,l,u,v;if(t){if(!this._filterUpToDate){var b=i.pixelRatio;r.setSize(i.width/i.pixelRatio,i.height/i.pixelRatio);try{for(o=t.length,a.clear(),a.drawImage(i._canvas,0,0,i.getWidth()/b,i.getHeight()/b),l=a.getImageData(0,0,r.getWidth(),r.getHeight()),u=0;u<o;u++){if(v=t[u],typeof v!="function"){U.Util.error("Filter should be type of function, but got "+typeof v+" instead. Please check correct filters");continue}v.call(this,l),a.putImageData(l,0,0)}}catch(R){U.Util.error("Unable to apply filter. "+R.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return r}return i}on(t,e){if(this._cache&&this._cache.delete(Ht),arguments.length===3)return this._delegate.apply(this,arguments);var i=t.split(Wt),r=i.length,a,o,l,u,v;for(a=0;a<r;a++)o=i[a],l=o.split("."),u=l[0],v=l[1]||"",this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:v,handler:e});return this}off(t,e){var i=(t||"").split(Wt),r=i.length,a,o,l,u,v,b;if(this._cache&&this._cache.delete(Ht),!t)for(o in this.eventListeners)this._off(o);for(a=0;a<r;a++)if(l=i[a],u=l.split("."),v=u[0],b=u[1],v)this.eventListeners[v]&&this._off(v,b,e);else for(o in this.eventListeners)this._off(o,b,e);return this}dispatchEvent(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(i){e.call(this,i.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,i){var r=this;this.on(t,function(a){for(var o=a.target.findAncestors(e,!0,r),l=0;l<o.length;l++)a=U.Util.cloneObject(a),a.currentTarget=o[l],i.call(o[l],a)})}remove(){return this.isDragging()&&this.stopDrag(),ot.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(gt),this._clearSelfAndDescendantCache(Xt),this._clearSelfAndDescendantCache(we),this._clearSelfAndDescendantCache(Ae),this._clearSelfAndDescendantCache(ce),this._clearSelfAndDescendantCache(de)}_remove(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){var e="get"+U.Util._capitalize(t);return U.Util._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){for(var t=this.getParent(),e=[];t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{var e,i;if(!t)return this;for(e in t)e!==xi&&(i=Ee+U.Util._capitalize(e),U.Util._isFunction(this[i])?this[i](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(de,this._isListening)}_isListening(t){if(!this.listening())return!1;const i=this.getParent();return i&&i!==t&&this!==t?i._isListening(t):!0}isVisible(){return this._getCache(ce,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const i=this.getParent();return i&&i!==t&&this!==t?i._isVisible(t):!0}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);var i=this.getLayer(),r=!1;ot.DD._dragElements.forEach(o=>{o.dragStatus==="dragging"&&(o.node.nodeType==="Stage"||o.node.getLayer()===i)&&(r=!0)});var a=!e&&!yt.Konva.hitOnDragEnabled&&(r||yt.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!a}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var t=this.getDepth(),e=this,i=0,r,a,o,l;function u(b){for(r=[],a=b.length,o=0;o<a;o++)l=b[o],i++,l.nodeType!==xe&&(r=r.concat(l.getChildren().slice())),l._id===e._id&&(o=a);r.length>0&&r[0].getDepth()<=t&&u(r)}const v=this.getStage();return e.nodeType!==ki&&v&&u(v.getChildren()),i}getDepth(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Ct),this._clearSelfAndDescendantCache(gt)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const t=this.getStage();if(!t)return null;var e=t.getPointerPosition();if(!e)return null;var i=this.getAbsoluteTransform().copy();return i.invert(),i.point(e)}getAbsolutePosition(t){let e=!1,i=this.parent;for(;i;){if(i.isCached()){e=!0;break}i=i.parent}e&&!t&&(t=!0);var r=this.getAbsoluteTransform(t).getMatrix(),a=new U.Transform,o=this.offset();return a.m=r.slice(),a.translate(o.x,o.y),a.getTranslation()}setAbsolutePosition(t){const{x:e,y:i,...r}=this._clearTransform();this.attrs.x=e,this.attrs.y=i,this._clearCache(Ct);var a=this._getAbsoluteTransform().copy();return a.invert(),a.translate(t.x,t.y),t={x:this.attrs.x+a.getTranslation().x,y:this.attrs.y+a.getTranslation().y},this._setTransform(r),this.setPosition({x:t.x,y:t.y}),this._clearCache(Ct),this._clearSelfAndDescendantCache(gt),this}_setTransform(t){var e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){var e=t.x,i=t.y,r=this.x(),a=this.y();return e!==void 0&&(r+=e),i!==void 0&&(a+=i),this.setPosition({x:r,y:a}),this}_eachAncestorReverse(t,e){var i=[],r=this.getParent(),a,o;if(!(e&&e._id===this._id)){for(i.unshift(this);r&&(!e||r._id!==e._id);)i.unshift(r),r=r.parent;for(a=i.length,o=0;o<a;o++)t(i[o])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return U.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1?(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return U.Util.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1?(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return U.Util.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return U.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(t){if(!this.parent)return U.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&U.Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(Xt,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){var t=this.getAttrs(),e,i,r,a,o;const l={attrs:{},className:this.getClassName()};for(e in t)i=t[e],o=U.Util.isObject(i)&&!U.Util._isPlainObject(i)&&!U.Util._isArray(i),!o&&(r=typeof this[e]=="function"&&this[e],delete t[e],a=r?r.call(this):null,t[e]=i,a!==i&&(l.attrs[e]=i));return U.Util._prepareToStringify(l)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,i){var r=[];e&&this._isMatch(t)&&r.push(this);for(var a=this.parent;a;){if(a===i)return r;a._isMatch(t)&&r.push(a),a=a.parent}return r}isAncestorOf(t){return!1}findAncestor(t,e,i){return this.findAncestors(t,e,i)[0]}_isMatch(t){if(!t)return!1;if(typeof t=="function")return t(this);var e=t.replace(/ /g,"").split(","),i=e.length,r,a;for(r=0;r<i;r++)if(a=e[r],U.Util.isValidSelector(a)||(U.Util.warn('Selector "'+a+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),U.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),U.Util.warn("Konva is awesome, right?")),a.charAt(0)==="#"){if(this.id()===a.slice(1))return!0}else if(a.charAt(0)==="."){if(this.hasName(a.slice(1)))return!0}else if(this.className===a||this.nodeType===a)return!0;return!1}getLayer(){var t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(Ae,this._getStage)}_getStage(){var t=this.getParent();return t?t.getStage():null}fire(t,e={},i){return e.target=e.target||this,i?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(gt,this._getAbsoluteTransform)}_getAbsoluteTransform(t){var e;if(t)return e=new U.Transform,this._eachAncestorReverse(function(r){var a=r.transformsEnabled();a==="all"?e.multiply(r.getTransform()):a==="position"&&e.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},t),e;e=this._cache.get(gt)||new U.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var i=this.transformsEnabled();if(i==="all")e.multiply(this.getTransform());else if(i==="position"){const r=this.attrs.x||0,a=this.attrs.y||0,o=this.attrs.offsetX||0,l=this.attrs.offsetY||0;e.translate(r-o,a-l)}return e.dirty=!1,e}getAbsoluteScale(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();const r=this.getAbsoluteTransform(t).decompose();return{x:r.scaleX,y:r.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Ct,this._getTransform)}_getTransform(){var t,e,i=this._cache.get(Ct)||new U.Transform;i.reset();var r=this.x(),a=this.y(),o=yt.Konva.getAngle(this.rotation()),l=(t=this.attrs.scaleX)!==null&&t!==void 0?t:1,u=(e=this.attrs.scaleY)!==null&&e!==void 0?e:1,v=this.attrs.skewX||0,b=this.attrs.skewY||0,R=this.attrs.offsetX||0,A=this.attrs.offsetY||0;return(r!==0||a!==0)&&i.translate(r,a),o!==0&&i.rotate(o),(v!==0||b!==0)&&i.skew(v,b),(l!==1||u!==1)&&i.scale(l,u),(R!==0||A!==0)&&i.translate(-1*R,-1*A),i.dirty=!1,i}clone(t){var e=U.Util.cloneObject(this.attrs),i,r,a,o,l;for(i in t)e[i]=t[i];var u=new this.constructor(e);for(i in this.eventListeners)for(r=this.eventListeners[i],a=r.length,o=0;o<a;o++)l=r[o],l.name.indexOf(Ai)<0&&(u.eventListeners[i]||(u.eventListeners[i]=[]),u.eventListeners[i].push(l));return u}_toKonvaCanvas(t){t=t||{};var e=this.getClientRect(),i=this.getStage(),r=t.x!==void 0?t.x:Math.floor(e.x),a=t.y!==void 0?t.y:Math.floor(e.y),o=t.pixelRatio||1,l=new Ft.SceneCanvas({width:t.width||Math.ceil(e.width)||(i?i.width():0),height:t.height||Math.ceil(e.height)||(i?i.height():0),pixelRatio:o}),u=l.getContext();const v=new Ft.SceneCanvas({width:l.width/l.pixelRatio+Math.abs(r),height:l.height/l.pixelRatio+Math.abs(a),pixelRatio:l.pixelRatio});return t.imageSmoothingEnabled===!1&&(u._context.imageSmoothingEnabled=!1),u.save(),(r||a)&&u.translate(-1*r,-1*a),this.drawScene(l,void 0,v),u.restore(),l}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){t=t||{};var e=t.mimeType||null,i=t.quality||null,r=this._toKonvaCanvas(t).toDataURL(e,i);return t.callback&&t.callback(r),r}toImage(t){return new Promise((e,i)=>{try{const r=t==null?void 0:t.callback;r&&delete t.callback,U.Util._urlToImage(this.toDataURL(t),function(a){e(a),r==null||r(a)})}catch(r){i(r)}})}toBlob(t){return new Promise((e,i)=>{try{const r=t==null?void 0:t.callback;r&&delete t.callback,this.toCanvas(t).toBlob(a=>{e(a),r==null||r(a)},t==null?void 0:t.mimeType,t==null?void 0:t.quality)}catch(r){i(r)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():yt.Konva.dragDistance}_off(t,e,i){var r=this.eventListeners[t],a,o,l;for(a=0;a<r.length;a++)if(o=r[a].name,l=r[a].handler,(o!=="konva"||e==="konva")&&(!e||o===e)&&(!i||i===l)){if(r.splice(a,1),r.length===0){delete this.eventListeners[t];break}a--}}_fireChangeEvent(t,e,i){this._fire(t+Ei,{oldVal:e,newVal:i})}addName(t){if(!this.hasName(t)){var e=this.name(),i=e?e+" "+t:t;this.name(i)}return this}hasName(t){if(!t)return!1;const e=this.name();if(!e)return!1;var i=(e||"").split(/\s/g);return i.indexOf(t)!==-1}removeName(t){var e=(this.name()||"").split(/\s/g),i=e.indexOf(t);return i!==-1&&(e.splice(i,1),this.name(e.join(" "))),this}setAttr(t,e){var i=this[Ee+U.Util._capitalize(t)];return U.Util._isFunction(i)?i.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(yt.Konva.autoDrawEnabled){const t=this.getLayer()||this.getStage();t==null||t.batchDraw()}}_setAttr(t,e){var i=this.attrs[t];i===e&&!U.Util.isObject(e)||(e==null?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,i,e),this._requestDraw())}_setComponentAttr(t,e,i){var r;i!==void 0&&(r=this.attrs[t],r||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=i,this._fireChangeEvent(t,r,i))}_fireAndBubble(t,e,i){e&&this.nodeType===xe&&(e.target=this);var r=(t===Pe||t===Te)&&(i&&(this===i||this.isAncestorOf&&this.isAncestorOf(i))||this.nodeType==="Stage"&&!i);if(!r){this._fire(t,e);var a=(t===Pe||t===Te)&&i&&i.isAncestorOf&&i.isAncestorOf(this)&&!i.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!a&&(i&&i.parent?this._fireAndBubble.call(this.parent,t,e,i):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){var e,i,r;const a=(e=this._cache.get(Ht))!==null&&e!==void 0?e:{};let o=a==null?void 0:a[t];if(o===void 0){o=[];let l=Object.getPrototypeOf(this);for(;l;){const u=(r=(i=l.eventListeners)===null||i===void 0?void 0:i[t])!==null&&r!==void 0?r:[];o.push(...u),l=Object.getPrototypeOf(l)}a[t]=o,this._cache.set(Ht,a)}return o}_fire(t,e){e=e||{},e.currentTarget=this,e.type=t;const i=this._getProtoListeners(t);if(i)for(var r=0;r<i.length;r++)i[r].handler.call(this,e);const a=this.eventListeners[t];if(a)for(var r=0;r<a.length;r++)a[r].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){var e=t?t.pointerId:void 0,i=this.getStage(),r=this.getAbsolutePosition();if(i){var a=i._getPointerById(e)||i._changedPointerPositions[0]||r;ot.DD._dragElements.set(this._id,{node:this,startPointerPos:a,offset:{x:a.x-r.x,y:a.y-r.y},dragStatus:"ready",pointerId:e})}}startDrag(t,e=!0){ot.DD._dragElements.has(this._id)||this._createDragElement(t);const i=ot.DD._dragElements.get(this._id);i.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const i=this.getStage()._getPointerById(e.pointerId);if(i){var r={x:i.x-e.offset.x,y:i.y-e.offset.y},a=this.dragBoundFunc();if(a!==void 0){const o=a.call(this,r,t);o?r=o:U.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==r.x||this._lastPos.y!==r.y)&&(this.setAbsolutePosition(r),this._requestDraw()),this._lastPos=r}}stopDrag(t){const e=ot.DD._dragElements.get(this._id);e&&(e.dragStatus="stopped"),ot.DD._endDragBefore(t),ot.DD._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=ot.DD._dragElements.get(this._id);return t?t.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){var e=t.evt.button!==void 0,i=!e||yt.Konva.dragButtons.indexOf(t.evt.button)>=0;if(i&&!this.isDragging()){var r=!1;ot.DD._dragElements.forEach(a=>{this.isAncestorOf(a.node)&&(r=!0)}),r||this._createDragElement(t)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage();if(!t)return;const e=ot.DD._dragElements.get(this._id),i=e&&e.dragStatus==="dragging",r=e&&e.dragStatus==="ready";i?this.stopDrag():r&&ot.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const i={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return U.Util.haveIntersection(i,this.getClientRect())}static create(t,e){return U.Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){var i=F.prototype.getClassName.call(t),r=t.children,a,o,l;e&&(t.attrs.container=e),yt.Konva[i]||(U.Util.warn('Can not find a node with class name "'+i+'". Fallback to "Shape".'),i="Shape");const u=yt.Konva[i];if(a=new u(t.attrs),r)for(o=r.length,l=0;l<o;l++)a.add(F._createNode(r[l]));return a}}St.Node=F;F.prototype.nodeType="Node";F.prototype._attrsAffectingSize=[];F.prototype.eventListeners={};F.prototype.on.call(F.prototype,Di,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(Ct),this._clearSelfAndDescendantCache(gt)});F.prototype.on.call(F.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(ce)});F.prototype.on.call(F.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(de)});F.prototype.on.call(F.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(Xt)});const M=It.Factory.addGetterSetter;M(F,"zIndex");M(F,"absolutePosition");M(F,"position");M(F,"x",0,(0,j.getNumberValidator)());M(F,"y",0,(0,j.getNumberValidator)());M(F,"globalCompositeOperation","source-over",(0,j.getStringValidator)());M(F,"opacity",1,(0,j.getNumberValidator)());M(F,"name","",(0,j.getStringValidator)());M(F,"id","",(0,j.getStringValidator)());M(F,"rotation",0,(0,j.getNumberValidator)());It.Factory.addComponentsGetterSetter(F,"scale",["x","y"]);M(F,"scaleX",1,(0,j.getNumberValidator)());M(F,"scaleY",1,(0,j.getNumberValidator)());It.Factory.addComponentsGetterSetter(F,"skew",["x","y"]);M(F,"skewX",0,(0,j.getNumberValidator)());M(F,"skewY",0,(0,j.getNumberValidator)());It.Factory.addComponentsGetterSetter(F,"offset",["x","y"]);M(F,"offsetX",0,(0,j.getNumberValidator)());M(F,"offsetY",0,(0,j.getNumberValidator)());M(F,"dragDistance",null,(0,j.getNumberValidator)());M(F,"width",0,(0,j.getNumberValidator)());M(F,"height",0,(0,j.getNumberValidator)());M(F,"listening",!0,(0,j.getBooleanValidator)());M(F,"preventDefault",!0,(0,j.getBooleanValidator)());M(F,"filters",null,function(s){return this._filterUpToDate=!1,s});M(F,"visible",!0,(0,j.getBooleanValidator)());M(F,"transformsEnabled","all",(0,j.getStringValidator)());M(F,"size");M(F,"dragBoundFunc");M(F,"draggable",!1,(0,j.getBooleanValidator)());It.Factory.backCompat(F,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.Container=void 0;const Rt=dt,ie=St,Jt=N;class Et extends ie.Node{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const e=this.children||[];var i=[];return e.forEach(function(r){t(r)&&i.push(r)}),i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(t.length===0)return this;if(t.length>1){for(var e=0;e<t.length;e++)this.add(t[e]);return this}const i=t[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){var i=[];return this._descendants(r=>{const a=r._isMatch(t);return a&&i.push(r),!!(a&&e)}),i}_descendants(t){let e=!1;const i=this.getChildren();for(const r of i){if(e=t(r),e)return!0;if(r.hasChildren()&&(e=r._descendants(t),e))return!0}return!1}toObject(){var t=ie.Node.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){var e=ie.Node.prototype.clone.call(this,t);return this.getChildren().forEach(function(i){e.add(i.clone())}),e}getAllIntersections(t){var e=[];return this.find("Shape").forEach(i=>{i.isVisible()&&i.intersects(t)&&e.push(i)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),!this.isCached()&&((e=this.children)===null||e===void 0||e.forEach(function(i){i._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;(t=this.children)===null||t===void 0||t.forEach(function(e,i){e.index=i}),this._requestDraw()}drawScene(t,e,i){var r=this.getLayer(),a=t||r&&r.getCanvas(),o=a&&a.getContext(),l=this._getCanvasCache(),u=l&&l.scene,v=a&&a.isCache;if(!this.isVisible()&&!v)return this;if(u){o.save();var b=this.getAbsoluteTransform(e).getMatrix();o.transform(b[0],b[1],b[2],b[3],b[4],b[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",a,e,i);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;var i=this.getLayer(),r=t||i&&i.hitCanvas,a=r&&r.getContext(),o=this._getCanvasCache(),l=o&&o.hit;if(l){a.save();var u=this.getAbsoluteTransform(e).getMatrix();a.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedHitCanvas(a),a.restore()}else this._drawChildren("drawHit",r,e);return this}_drawChildren(t,e,i,r){var a,o=e&&e.getContext(),l=this.clipWidth(),u=this.clipHeight(),v=this.clipFunc(),b=typeof l=="number"&&typeof u=="number"||v;const R=i===this;if(b){o.save();var A=this.getAbsoluteTransform(i),p=A.getMatrix();o.transform(p[0],p[1],p[2],p[3],p[4],p[5]),o.beginPath();let C;if(v)C=v.call(this,o,this);else{var g=this.clipX(),m=this.clipY();o.rect(g||0,m||0,l,u)}o.clip.apply(o,C),p=A.copy().invert().getMatrix(),o.transform(p[0],p[1],p[2],p[3],p[4],p[5])}var S=!R&&this.globalCompositeOperation()!=="source-over"&&t==="drawScene";S&&(o.save(),o._applyGlobalCompositeOperation(this)),(a=this.children)===null||a===void 0||a.forEach(function(C){C[t](e,i,r)}),S&&o.restore(),b&&o.restore()}getClientRect(t={}){var e,i=t.skipTransform,r=t.relativeTo,a,o,l,u,v={x:1/0,y:1/0,width:0,height:0},b=this;(e=this.children)===null||e===void 0||e.forEach(function(m){if(m.visible()){var S=m.getClientRect({relativeTo:b,skipShadow:t.skipShadow,skipStroke:t.skipStroke});S.width===0&&S.height===0||(a===void 0?(a=S.x,o=S.y,l=S.x+S.width,u=S.y+S.height):(a=Math.min(a,S.x),o=Math.min(o,S.y),l=Math.max(l,S.x+S.width),u=Math.max(u,S.y+S.height)))}});for(var R=this.find("Shape"),A=!1,p=0;p<R.length;p++){var g=R[p];if(g._isVisible(this)){A=!0;break}}return A&&a!==void 0?v={x:a,y:o,width:l-a,height:u-o}:v={x:0,y:0,width:0,height:0},i?v:this._transformedRect(v,r)}}Tt.Container=Et;Rt.Factory.addComponentsGetterSetter(Et,"clip",["x","y","width","height"]);Rt.Factory.addGetterSetter(Et,"clipX",void 0,(0,Jt.getNumberValidator)());Rt.Factory.addGetterSetter(Et,"clipY",void 0,(0,Jt.getNumberValidator)());Rt.Factory.addGetterSetter(Et,"clipWidth",void 0,(0,Jt.getNumberValidator)());Rt.Factory.addGetterSetter(Et,"clipHeight",void 0,(0,Jt.getNumberValidator)());Rt.Factory.addGetterSetter(Et,"clipFunc");var Me={},nt={};Object.defineProperty(nt,"__esModule",{value:!0});nt.releaseCapture=nt.setPointerCapture=nt.hasPointerCapture=nt.createEvent=nt.getCapturedShape=void 0;const Gi=z,Ut=new Map,Be=Gi.Konva._global.PointerEvent!==void 0;function Oi(s){return Ut.get(s)}nt.getCapturedShape=Oi;function ge(s){return{evt:s,pointerId:s.pointerId}}nt.createEvent=ge;function Fi(s,t){return Ut.get(s)===t}nt.hasPointerCapture=Fi;function Li(s,t){Ve(s),t.getStage()&&(Ut.set(s,t),Be&&t._fire("gotpointercapture",ge(new PointerEvent("gotpointercapture"))))}nt.setPointerCapture=Li;function Ve(s,t){const e=Ut.get(s);if(!e)return;const i=e.getStage();i&&i.content,Ut.delete(s),Be&&e._fire("lostpointercapture",ge(new PointerEvent("lostpointercapture")))}nt.releaseCapture=Ve;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Stage=s.stages=void 0;const t=tt,e=dt,i=Tt,r=z,a=ht,o=qt,l=z,u=nt;var v="Stage",b="string",R="px",A="mouseout",p="mouseleave",g="mouseover",m="mouseenter",S="mousemove",C="mousedown",T="mouseup",n="pointermove",h="pointerdown",f="pointerup",y="pointercancel",x="lostpointercapture",c="pointerout",E="pointerleave",_="pointerover",P="pointerenter",G="contextmenu",k="touchstart",L="touchend",O="touchmove",et="touchcancel",K="wheel",q=5,Z=[[m,"_pointerenter"],[C,"_pointerdown"],[S,"_pointermove"],[T,"_pointerup"],[p,"_pointerleave"],[k,"_pointerdown"],[O,"_pointermove"],[L,"_pointerup"],[et,"_pointercancel"],[g,"_pointerover"],[K,"_wheel"],[G,"_contextmenu"],[h,"_pointerdown"],[n,"_pointermove"],[f,"_pointerup"],[y,"_pointercancel"],[x,"_lostpointercapture"]];const $={mouse:{[c]:A,[E]:p,[_]:g,[P]:m,[n]:S,[h]:C,[f]:T,[y]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[c]:"touchout",[E]:"touchleave",[_]:"touchover",[P]:"touchenter",[n]:O,[h]:k,[f]:L,[y]:et,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[c]:c,[E]:E,[_]:_,[P]:P,[n]:n,[h]:h,[f]:f,[y]:y,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},B=J=>J.indexOf("pointer")>=0?"pointer":J.indexOf("touch")>=0?"touch":"mouse",at=J=>{const d=B(J);if(d==="pointer")return r.Konva.pointerEventsEnabled&&$.pointer;if(d==="touch")return $.touch;if(d==="mouse")return $.mouse};function it(J={}){return(J.clipFunc||J.clipWidth||J.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),J}const Q="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";s.stages=[];class ct extends i.Container{constructor(d){super(it(d)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),s.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{it(this.attrs)}),this._checkVisibility()}_validateAdd(d){const w=d.getType()==="Layer",D=d.getType()==="FastLayer";w||D||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const d=this.visible()?"":"none";this.content.style.display=d}setContainer(d){if(typeof d===b){if(d.charAt(0)==="."){var w=d.slice(1);d=document.getElementsByClassName(w)[0]}else{var D;d.charAt(0)!=="#"?D=d:D=d.slice(1),d=document.getElementById(D)}if(!d)throw"Can not find container in document with id "+D}return this._setAttr("container",d),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),d.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var d=this.children,w=d.length,D;for(D=0;D<w;D++)d[D].clear();return this}clone(d){return d||(d={}),d.container=typeof document<"u"&&document.createElement("div"),i.Container.prototype.clone.call(this,d)}destroy(){super.destroy();var d=this.content;d&&t.Util._isInDocument(d)&&this.container().removeChild(d);var w=s.stages.indexOf(this);return w>-1&&s.stages.splice(w,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const d=this._pointerPositions[0]||this._changedPointerPositions[0];return d?{x:d.x,y:d.y}:(t.Util.warn(Q),null)}_getPointerById(d){return this._pointerPositions.find(w=>w.id===d)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(d){d=d||{},d.x=d.x||0,d.y=d.y||0,d.width=d.width||this.width(),d.height=d.height||this.height();var w=new a.SceneCanvas({width:d.width,height:d.height,pixelRatio:d.pixelRatio||1}),D=w.getContext()._context,H=this.children;return(d.x||d.y)&&D.translate(-1*d.x,-1*d.y),H.forEach(function(I){if(I.isVisible()){var W=I._toKonvaCanvas(d);D.drawImage(W._canvas,d.x,d.y,W.getWidth()/W.getPixelRatio(),W.getHeight()/W.getPixelRatio())}}),w}getIntersection(d){if(!d)return null;var w=this.children,D=w.length,H=D-1,I;for(I=H;I>=0;I--){const W=w[I].getIntersection(d);if(W)return W}return null}_resizeDOM(){var d=this.width(),w=this.height();this.content&&(this.content.style.width=d+R,this.content.style.height=w+R),this.bufferCanvas.setSize(d,w),this.bufferHitCanvas.setSize(d,w),this.children.forEach(D=>{D.setSize({width:d,height:w}),D.draw()})}add(d,...w){if(arguments.length>1){for(var D=0;D<arguments.length;D++)this.add(arguments[D]);return this}super.add(d);var H=this.children.length;return H>q&&t.Util.warn("The stage has "+H+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),d.setSize({width:this.width(),height:this.height()}),d.draw(),r.Konva.isBrowser&&this.content.appendChild(d.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(d){return u.hasPointerCapture(d,this)}setPointerCapture(d){u.setPointerCapture(d,this)}releaseCapture(d){u.releaseCapture(d,this)}getLayers(){return this.children}_bindContentEvents(){r.Konva.isBrowser&&Z.forEach(([d,w])=>{this.content.addEventListener(d,D=>{this[w](D)},{passive:!1})})}_pointerenter(d){this.setPointersPositions(d);const w=at(d.type);w&&this._fire(w.pointerenter,{evt:d,target:this,currentTarget:this})}_pointerover(d){this.setPointersPositions(d);const w=at(d.type);w&&this._fire(w.pointerover,{evt:d,target:this,currentTarget:this})}_getTargetShape(d){let w=this[d+"targetShape"];return w&&!w.getStage()&&(w=null),w}_pointerleave(d){const w=at(d.type),D=B(d.type);if(w){this.setPointersPositions(d);var H=this._getTargetShape(D),I=!(r.Konva.isDragging()||r.Konva.isTransforming())||r.Konva.hitOnDragEnabled;H&&I?(H._fireAndBubble(w.pointerout,{evt:d}),H._fireAndBubble(w.pointerleave,{evt:d}),this._fire(w.pointerleave,{evt:d,target:this,currentTarget:this}),this[D+"targetShape"]=null):I&&(this._fire(w.pointerleave,{evt:d,target:this,currentTarget:this}),this._fire(w.pointerout,{evt:d,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}}_pointerdown(d){const w=at(d.type),D=B(d.type);if(w){this.setPointersPositions(d);var H=!1;this._changedPointerPositions.forEach(I=>{var W=this.getIntersection(I);if(o.DD.justDragged=!1,r.Konva["_"+D+"ListenClick"]=!0,!W||!W.isListening())return;r.Konva.capturePointerEventsEnabled&&W.setPointerCapture(I.id),this[D+"ClickStartShape"]=W,W._fireAndBubble(w.pointerdown,{evt:d,pointerId:I.id}),H=!0;const st=d.type.indexOf("touch")>=0;W.preventDefault()&&d.cancelable&&st&&d.preventDefault()}),H||this._fire(w.pointerdown,{evt:d,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(d){const w=at(d.type),D=B(d.type);if(!w)return;r.Konva.isDragging()&&o.DD.node.preventDefault()&&d.cancelable&&d.preventDefault(),this.setPointersPositions(d);var H=!(r.Konva.isDragging()||r.Konva.isTransforming())||r.Konva.hitOnDragEnabled;if(!H)return;var I={};let W=!1;var st=this._getTargetShape(D);this._changedPointerPositions.forEach(mt=>{const V=u.getCapturedShape(mt.id)||this.getIntersection(mt),xt=mt.id,ut={evt:d,pointerId:xt};var At=st!==V;if(At&&st&&(st._fireAndBubble(w.pointerout,{...ut},V),st._fireAndBubble(w.pointerleave,{...ut},V)),V){if(I[V._id])return;I[V._id]=!0}V&&V.isListening()?(W=!0,At&&(V._fireAndBubble(w.pointerover,{...ut},st),V._fireAndBubble(w.pointerenter,{...ut},st),this[D+"targetShape"]=V),V._fireAndBubble(w.pointermove,{...ut})):st&&(this._fire(w.pointerover,{evt:d,target:this,currentTarget:this,pointerId:xt}),this[D+"targetShape"]=null)}),W||this._fire(w.pointermove,{evt:d,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(d){const w=at(d.type),D=B(d.type);if(!w)return;this.setPointersPositions(d);const H=this[D+"ClickStartShape"],I=this[D+"ClickEndShape"];var W={};let st=!1;this._changedPointerPositions.forEach(mt=>{const V=u.getCapturedShape(mt.id)||this.getIntersection(mt);if(V){if(V.releaseCapture(mt.id),W[V._id])return;W[V._id]=!0}const xt=mt.id,ut={evt:d,pointerId:xt};let At=!1;r.Konva["_"+D+"InDblClickWindow"]?(At=!0,clearTimeout(this[D+"DblTimeout"])):o.DD.justDragged||(r.Konva["_"+D+"InDblClickWindow"]=!0,clearTimeout(this[D+"DblTimeout"])),this[D+"DblTimeout"]=setTimeout(function(){r.Konva["_"+D+"InDblClickWindow"]=!1},r.Konva.dblClickWindow),V&&V.isListening()?(st=!0,this[D+"ClickEndShape"]=V,V._fireAndBubble(w.pointerup,{...ut}),r.Konva["_"+D+"ListenClick"]&&H&&H===V&&(V._fireAndBubble(w.pointerclick,{...ut}),At&&I&&I===V&&V._fireAndBubble(w.pointerdblclick,{...ut}))):(this[D+"ClickEndShape"]=null,r.Konva["_"+D+"ListenClick"]&&this._fire(w.pointerclick,{evt:d,target:this,currentTarget:this,pointerId:xt}),At&&this._fire(w.pointerdblclick,{evt:d,target:this,currentTarget:this,pointerId:xt}))}),st||this._fire(w.pointerup,{evt:d,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r.Konva["_"+D+"ListenClick"]=!1,d.cancelable&&D!=="touch"&&d.preventDefault()}_contextmenu(d){this.setPointersPositions(d);var w=this.getIntersection(this.getPointerPosition());w&&w.isListening()?w._fireAndBubble(G,{evt:d}):this._fire(G,{evt:d,target:this,currentTarget:this})}_wheel(d){this.setPointersPositions(d);var w=this.getIntersection(this.getPointerPosition());w&&w.isListening()?w._fireAndBubble(K,{evt:d}):this._fire(K,{evt:d,target:this,currentTarget:this})}_pointercancel(d){this.setPointersPositions(d);const w=u.getCapturedShape(d.pointerId)||this.getIntersection(this.getPointerPosition());w&&w._fireAndBubble(f,u.createEvent(d)),u.releaseCapture(d.pointerId)}_lostpointercapture(d){u.releaseCapture(d.pointerId)}setPointersPositions(d){var w=this._getContentPosition(),D=null,H=null;d=d||window.event,d.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(d.touches,I=>{this._pointerPositions.push({id:I.identifier,x:(I.clientX-w.left)/w.scaleX,y:(I.clientY-w.top)/w.scaleY})}),Array.prototype.forEach.call(d.changedTouches||d.touches,I=>{this._changedPointerPositions.push({id:I.identifier,x:(I.clientX-w.left)/w.scaleX,y:(I.clientY-w.top)/w.scaleY})})):(D=(d.clientX-w.left)/w.scaleX,H=(d.clientY-w.top)/w.scaleY,this.pointerPos={x:D,y:H},this._pointerPositions=[{x:D,y:H,id:t.Util._getFirstPointerId(d)}],this._changedPointerPositions=[{x:D,y:H,id:t.Util._getFirstPointerId(d)}])}_setPointerPosition(d){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(d)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var d=this.content.getBoundingClientRect();return{top:d.top,left:d.left,scaleX:d.width/this.content.clientWidth||1,scaleY:d.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new a.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new a.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!r.Konva.isBrowser){var d=this.container();if(!d)throw"Stage has no container. A container is required.";d.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),d.appendChild(this.content),this._resizeDOM()}}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(d){d.batchDraw()}),this}}s.Stage=ct,ct.prototype.nodeType=v,(0,l._registerNode)(ct),e.Factory.addGetterSetter(ct,"container")})(Me);var Mt={},Gt={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Shape=s.shapes=void 0;const t=z,e=tt,i=dt,r=St,a=N,o=z,l=nt;var u="hasShadow",v="shadowRGBA",b="patternImage",R="linearGradient",A="radialGradient";let p;function g(){return p||(p=e.Util.createCanvasElement().getContext("2d"),p)}s.shapes={};function m(E){const _=this.attrs.fillRule;_?E.fill(_):E.fill()}function S(E){E.stroke()}function C(E){E.fill()}function T(E){E.stroke()}function n(){this._clearCache(u)}function h(){this._clearCache(v)}function f(){this._clearCache(b)}function y(){this._clearCache(R)}function x(){this._clearCache(A)}class c extends r.Node{constructor(_){super(_);let P;for(;P=e.Util.getRandomColor(),!(P&&!(P in s.shapes)););this.colorKey=P,s.shapes[P]=this}getContext(){return e.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return e.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(u,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(b,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var _=g();const P=_.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(P&&P.setTransform){const G=new e.Transform;G.translate(this.fillPatternX(),this.fillPatternY()),G.rotate(t.Konva.getAngle(this.fillPatternRotation())),G.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),G.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const k=G.getMatrix(),L=typeof DOMMatrix>"u"?{a:k[0],b:k[1],c:k[2],d:k[3],e:k[4],f:k[5]}:new DOMMatrix(k);P.setTransform(L)}return P}}_getLinearGradient(){return this._getCache(R,this.__getLinearGradient)}__getLinearGradient(){var _=this.fillLinearGradientColorStops();if(_){for(var P=g(),G=this.fillLinearGradientStartPoint(),k=this.fillLinearGradientEndPoint(),L=P.createLinearGradient(G.x,G.y,k.x,k.y),O=0;O<_.length;O+=2)L.addColorStop(_[O],_[O+1]);return L}}_getRadialGradient(){return this._getCache(A,this.__getRadialGradient)}__getRadialGradient(){var _=this.fillRadialGradientColorStops();if(_){for(var P=g(),G=this.fillRadialGradientStartPoint(),k=this.fillRadialGradientEndPoint(),L=P.createRadialGradient(G.x,G.y,this.fillRadialGradientStartRadius(),k.x,k.y,this.fillRadialGradientEndRadius()),O=0;O<_.length;O+=2)L.addColorStop(_[O],_[O+1]);return L}}getShadowRGBA(){return this._getCache(v,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var _=e.Util.colorToRGBA(this.shadowColor());if(_)return"rgba("+_.r+","+_.g+","+_.b+","+_.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const _=this.hitStrokeWidth();return _==="auto"?this.hasStroke():this.strokeEnabled()&&!!_}intersects(_){var P=this.getStage();if(!P)return!1;const G=P.bufferHitCanvas;return G.getContext().clear(),this.drawHit(G,void 0,!0),G.context.getImageData(Math.round(_.x),Math.round(_.y),1,1).data[3]>0}destroy(){return r.Node.prototype.destroy.call(this),delete s.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(_){var P;if(!((P=this.attrs.perfectDrawEnabled)!==null&&P!==void 0?P:!0))return!1;const k=_||this.hasFill(),L=this.hasStroke(),O=this.getAbsoluteOpacity()!==1;if(k&&L&&O)return!0;const et=this.hasShadow(),K=this.shadowForStrokeEnabled();return!!(k&&L&&et&&K)}setStrokeHitEnabled(_){e.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),_?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var _=this.size();return{x:this._centroid?-_.width/2:0,y:this._centroid?-_.height/2:0,width:_.width,height:_.height}}getClientRect(_={}){const P=_.skipTransform,G=_.relativeTo,k=this.getSelfRect(),O=!_.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,et=k.width+O,K=k.height+O,q=!_.skipShadow&&this.hasShadow(),Z=q?this.shadowOffsetX():0,$=q?this.shadowOffsetY():0,B=et+Math.abs(Z),at=K+Math.abs($),it=q&&this.shadowBlur()||0,Q=B+it*2,ct=at+it*2,J={width:Q,height:ct,x:-(O/2+it)+Math.min(Z,0)+k.x,y:-(O/2+it)+Math.min($,0)+k.y};return P?J:this._transformedRect(J,G)}drawScene(_,P,G){var k=this.getLayer(),L=_||k.getCanvas(),O=L.getContext(),et=this._getCanvasCache(),K=this.getSceneFunc(),q=this.hasShadow(),Z,$,B=L.isCache,at=P===this;if(!this.isVisible()&&!at)return this;if(et){O.save();var it=this.getAbsoluteTransform(P).getMatrix();return O.transform(it[0],it[1],it[2],it[3],it[4],it[5]),this._drawCachedSceneCanvas(O),O.restore(),this}if(!K)return this;if(O.save(),this._useBufferCanvas()&&!B){Z=this.getStage();const J=G||Z.bufferCanvas;$=J.getContext(),$.clear(),$.save(),$._applyLineJoin(this);var Q=this.getAbsoluteTransform(P).getMatrix();$.transform(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5]),K.call(this,$,this),$.restore();var ct=J.pixelRatio;q&&O._applyShadow(this),O._applyOpacity(this),O._applyGlobalCompositeOperation(this),O.drawImage(J._canvas,0,0,J.width/ct,J.height/ct)}else{if(O._applyLineJoin(this),!at){var Q=this.getAbsoluteTransform(P).getMatrix();O.transform(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5]),O._applyOpacity(this),O._applyGlobalCompositeOperation(this)}q&&O._applyShadow(this),K.call(this,O,this)}return O.restore(),this}drawHit(_,P,G=!1){if(!this.shouldDrawHit(P,G))return this;var k=this.getLayer(),L=_||k.hitCanvas,O=L&&L.getContext(),et=this.hitFunc()||this.sceneFunc(),K=this._getCanvasCache(),q=K&&K.hit;if(this.colorKey||e.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),q){O.save();var Z=this.getAbsoluteTransform(P).getMatrix();return O.transform(Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]),this._drawCachedHitCanvas(O),O.restore(),this}if(!et)return this;if(O.save(),O._applyLineJoin(this),!(this===P)){var B=this.getAbsoluteTransform(P).getMatrix();O.transform(B[0],B[1],B[2],B[3],B[4],B[5])}return et.call(this,O,this),O.restore(),this}drawHitFromCache(_=0){var P=this._getCanvasCache(),G=this._getCachedSceneCanvas(),k=P.hit,L=k.getContext(),O=k.getWidth(),et=k.getHeight(),K,q,Z,$,B,at;L.clear(),L.drawImage(G._canvas,0,0,O,et);try{for(K=L.getImageData(0,0,O,et),q=K.data,Z=q.length,$=e.Util._hexToRgb(this.colorKey),B=0;B<Z;B+=4)at=q[B+3],at>_?(q[B]=$.r,q[B+1]=$.g,q[B+2]=$.b,q[B+3]=255):q[B+3]=0;L.putImageData(K,0,0)}catch(it){e.Util.error("Unable to draw hit graph from cached scene canvas. "+it.message)}return this}hasPointerCapture(_){return l.hasPointerCapture(_,this)}setPointerCapture(_){l.setPointerCapture(_,this)}releaseCapture(_){l.releaseCapture(_,this)}}s.Shape=c,c.prototype._fillFunc=m,c.prototype._strokeFunc=S,c.prototype._fillFuncHit=C,c.prototype._strokeFuncHit=T,c.prototype._centroid=!1,c.prototype.nodeType="Shape",(0,o._registerNode)(c),c.prototype.eventListeners={},c.prototype.on.call(c.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",n),c.prototype.on.call(c.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",h),c.prototype.on.call(c.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",f),c.prototype.on.call(c.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",y),c.prototype.on.call(c.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",x),i.Factory.addGetterSetter(c,"stroke",void 0,(0,a.getStringOrGradientValidator)()),i.Factory.addGetterSetter(c,"strokeWidth",2,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"fillAfterStrokeEnabled",!1),i.Factory.addGetterSetter(c,"hitStrokeWidth","auto",(0,a.getNumberOrAutoValidator)()),i.Factory.addGetterSetter(c,"strokeHitEnabled",!0,(0,a.getBooleanValidator)()),i.Factory.addGetterSetter(c,"perfectDrawEnabled",!0,(0,a.getBooleanValidator)()),i.Factory.addGetterSetter(c,"shadowForStrokeEnabled",!0,(0,a.getBooleanValidator)()),i.Factory.addGetterSetter(c,"lineJoin"),i.Factory.addGetterSetter(c,"lineCap"),i.Factory.addGetterSetter(c,"sceneFunc"),i.Factory.addGetterSetter(c,"hitFunc"),i.Factory.addGetterSetter(c,"dash"),i.Factory.addGetterSetter(c,"dashOffset",0,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"shadowColor",void 0,(0,a.getStringValidator)()),i.Factory.addGetterSetter(c,"shadowBlur",0,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"shadowOpacity",1,(0,a.getNumberValidator)()),i.Factory.addComponentsGetterSetter(c,"shadowOffset",["x","y"]),i.Factory.addGetterSetter(c,"shadowOffsetX",0,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"shadowOffsetY",0,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"fillPatternImage"),i.Factory.addGetterSetter(c,"fill",void 0,(0,a.getStringOrGradientValidator)()),i.Factory.addGetterSetter(c,"fillPatternX",0,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"fillPatternY",0,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"fillLinearGradientColorStops"),i.Factory.addGetterSetter(c,"strokeLinearGradientColorStops"),i.Factory.addGetterSetter(c,"fillRadialGradientStartRadius",0),i.Factory.addGetterSetter(c,"fillRadialGradientEndRadius",0),i.Factory.addGetterSetter(c,"fillRadialGradientColorStops"),i.Factory.addGetterSetter(c,"fillPatternRepeat","repeat"),i.Factory.addGetterSetter(c,"fillEnabled",!0),i.Factory.addGetterSetter(c,"strokeEnabled",!0),i.Factory.addGetterSetter(c,"shadowEnabled",!0),i.Factory.addGetterSetter(c,"dashEnabled",!0),i.Factory.addGetterSetter(c,"strokeScaleEnabled",!0),i.Factory.addGetterSetter(c,"fillPriority","color"),i.Factory.addComponentsGetterSetter(c,"fillPatternOffset",["x","y"]),i.Factory.addGetterSetter(c,"fillPatternOffsetX",0,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"fillPatternOffsetY",0,(0,a.getNumberValidator)()),i.Factory.addComponentsGetterSetter(c,"fillPatternScale",["x","y"]),i.Factory.addGetterSetter(c,"fillPatternScaleX",1,(0,a.getNumberValidator)()),i.Factory.addGetterSetter(c,"fillPatternScaleY",1,(0,a.getNumberValidator)()),i.Factory.addComponentsGetterSetter(c,"fillLinearGradientStartPoint",["x","y"]),i.Factory.addComponentsGetterSetter(c,"strokeLinearGradientStartPoint",["x","y"]),i.Factory.addGetterSetter(c,"fillLinearGradientStartPointX",0),i.Factory.addGetterSetter(c,"strokeLinearGradientStartPointX",0),i.Factory.addGetterSetter(c,"fillLinearGradientStartPointY",0),i.Factory.addGetterSetter(c,"strokeLinearGradientStartPointY",0),i.Factory.addComponentsGetterSetter(c,"fillLinearGradientEndPoint",["x","y"]),i.Factory.addComponentsGetterSetter(c,"strokeLinearGradientEndPoint",["x","y"]),i.Factory.addGetterSetter(c,"fillLinearGradientEndPointX",0),i.Factory.addGetterSetter(c,"strokeLinearGradientEndPointX",0),i.Factory.addGetterSetter(c,"fillLinearGradientEndPointY",0),i.Factory.addGetterSetter(c,"strokeLinearGradientEndPointY",0),i.Factory.addComponentsGetterSetter(c,"fillRadialGradientStartPoint",["x","y"]),i.Factory.addGetterSetter(c,"fillRadialGradientStartPointX",0),i.Factory.addGetterSetter(c,"fillRadialGradientStartPointY",0),i.Factory.addComponentsGetterSetter(c,"fillRadialGradientEndPoint",["x","y"]),i.Factory.addGetterSetter(c,"fillRadialGradientEndPointX",0),i.Factory.addGetterSetter(c,"fillRadialGradientEndPointY",0),i.Factory.addGetterSetter(c,"fillPatternRotation",0),i.Factory.addGetterSetter(c,"fillRule",void 0,(0,a.getStringValidator)()),i.Factory.backCompat(c,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(Gt);Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Layer=void 0;const ft=tt,re=Tt,kt=St,pe=dt,ke=ht,Ui=N,Ni=Gt,Ii=z;var Mi="#",Bi="beforeDraw",Vi="draw",He=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Hi=He.length;class Ot extends re.Container{constructor(t){super(t),this.canvas=new ke.SceneCanvas,this.hitCanvas=new ke.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){kt.Node.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var t=kt.Node.prototype.moveUp.call(this);if(!t)return!1;var e=this.getStage();return!e||!e.content?!1:(e.content.removeChild(this.getNativeCanvasElement()),this.index<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(kt.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(kt.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return kt.Node.prototype.remove.call(this),t&&t.parentNode&&ft.Util._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&ft.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),kt.Node.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){ft.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){ft.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,ft.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var e=1,i=!1;;){for(let r=0;r<Hi;r++){const a=He[r],o=this._getIntersection({x:t.x+a.x*e,y:t.y+a.y*e}),l=o.shape;if(l)return l;if(i=!!o.antialiased,!o.antialiased)break}if(i)e+=1;else return null}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,r=i[3];if(r===255){const a=ft.Util._rgbToHex(i[0],i[1],i[2]),o=Ni.shapes[Mi+a];return o?{shape:o}:{antialiased:!0}}else if(r>0)return{antialiased:!0};return{}}drawScene(t,e){var i=this.getLayer(),r=t||i&&i.getCanvas();return this._fire(Bi,{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),re.Container.prototype.drawScene.call(this,r,e),this._fire(Vi,{node:this}),this}drawHit(t,e){var i=this.getLayer(),r=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),re.Container.prototype.drawHit.call(this,r,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){ft.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return ft.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var t=this.parent,e=!!this.hitCanvas._canvas.parentNode;e?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}destroy(){return ft.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Mt.Layer=Ot;Ot.prototype.nodeType="Layer";(0,Ii._registerNode)(Ot);pe.Factory.addGetterSetter(Ot,"imageSmoothingEnabled",!0);pe.Factory.addGetterSetter(Ot,"clearBeforeDraw",!0);pe.Factory.addGetterSetter(Ot,"hitGraphEnabled",!0,(0,Ui.getBooleanValidator)());var Zt={};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.FastLayer=void 0;const Ki=tt,Yi=Mt,Xi=z;class ve extends Yi.Layer{constructor(t){super(t),this.listening(!1),Ki.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Zt.FastLayer=ve;ve.prototype.nodeType="FastLayer";(0,Xi._registerNode)(ve);var Qt={};Object.defineProperty(Qt,"__esModule",{value:!0});Qt.Group=void 0;const Wi=tt,zi=Tt,ji=z;class _e extends zi.Container{_validateAdd(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&Wi.Util.throw("You may only add groups and shapes to groups.")}}Qt.Group=_e;_e.prototype.nodeType="Group";(0,ji._registerNode)(_e);var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.Animation=void 0;const ae=z,De=tt,ne=function(){return ae.glob.performance&&ae.glob.performance.now?function(){return ae.glob.performance.now()}:function(){return new Date().getTime()}}();class lt{constructor(t,e){this.id=lt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:ne(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){let e=[];return t&&(e=Array.isArray(t)?t:[t]),this.layers=e,this}getLayers(){return this.layers}addLayer(t){const e=this.layers,i=e.length;for(let r=0;r<i;r++)if(e[r]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){const e=lt.animations,i=e.length;for(let r=0;r<i;r++)if(e[r].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=ne(),lt._addAnimation(this),this}stop(){return lt._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){const e=t.id,i=this.animations,r=i.length;for(let a=0;a<r;a++)if(i[a].id===e){this.animations.splice(a,1);break}}static _runFrames(){const t={},e=this.animations;for(let i=0;i<e.length;i++){const r=e[i],a=r.layers,o=r.func;r._updateFrameObject(ne());const l=a.length;let u;if(o?u=o.call(r,r.frame)!==!1:u=!0,!!u)for(let v=0;v<l;v++){const b=a[v];b._id!==void 0&&(t[b._id]=b)}}for(let i in t)t.hasOwnProperty(i)&&t[i].batchDraw()}static _animationLoop(){const t=lt;t.animations.length?(t._runFrames(),De.Util.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,De.Util.requestAnimFrame(this._animationLoop))}}Bt.Animation=lt;lt.animations=[];lt.animIdCounter=0;lt.animRunning=!1;var Ke={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Easings=s.Tween=void 0;const t=tt,e=Bt,i=St,r=z;var a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},o=1,l=2,u=3,v=0,b=["fill","stroke","shadowColor"];class R{constructor(g,m,S,C,T,n,h){this.prop=g,this.propFunc=m,this.begin=C,this._pos=C,this.duration=n,this._change=0,this.prevPos=0,this.yoyo=h,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=S,this._change=T-this.begin,this.pause()}fire(g){var m=this[g];m&&m()}setTime(g){g>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():g<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=g,this.update())}getTime(){return this._time}setPosition(g){this.prevPos=this._pos,this.propFunc(g),this._pos=g}getPosition(g){return g===void 0&&(g=this._time),this.func(g,this.begin,this._change,this.duration)}play(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=u,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(g){this.pause(),this._time=g,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var g=this.getTimer()-this._startTime;this.state===l?this.setTime(g):this.state===u&&this.setTime(this.duration-g)}pause(){this.state=o,this.fire("onPause")}getTimer(){return new Date().getTime()}}class A{constructor(g){var m=this,S=g.node,C=S._id,T,n=g.easing||s.Easings.Linear,h=!!g.yoyo,f;typeof g.duration>"u"?T=.3:g.duration===0?T=.001:T=g.duration,this.node=S,this._id=v++;var y=S.getLayer()||(S instanceof r.Konva.Stage?S.getLayers():null);y||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new e.Animation(function(){m.tween.onEnterFrame()},y),this.tween=new R(f,function(x){m._tweenFunc(x)},n,0,1,T*1e3,h),this._addListeners(),A.attrs[C]||(A.attrs[C]={}),A.attrs[C][this._id]||(A.attrs[C][this._id]={}),A.tweens[C]||(A.tweens[C]={});for(f in g)a[f]===void 0&&this._addAttr(f,g[f]);this.reset(),this.onFinish=g.onFinish,this.onReset=g.onReset,this.onUpdate=g.onUpdate}_addAttr(g,m){var S=this.node,C=S._id,T,n,h,f,y,x,c,E;if(h=A.tweens[C][g],h&&delete A.attrs[C][h][g],T=S.getAttr(g),t.Util._isArray(m))if(n=[],y=Math.max(m.length,T.length),g==="points"&&m.length!==T.length&&(m.length>T.length?(c=T,T=t.Util._prepareArrayForTween(T,m,S.closed())):(x=m,m=t.Util._prepareArrayForTween(m,T,S.closed()))),g.indexOf("fill")===0)for(f=0;f<y;f++)if(f%2===0)n.push(m[f]-T[f]);else{var _=t.Util.colorToRGBA(T[f]);E=t.Util.colorToRGBA(m[f]),T[f]=_,n.push({r:E.r-_.r,g:E.g-_.g,b:E.b-_.b,a:E.a-_.a})}else for(f=0;f<y;f++)n.push(m[f]-T[f]);else b.indexOf(g)!==-1?(T=t.Util.colorToRGBA(T),E=t.Util.colorToRGBA(m),n={r:E.r-T.r,g:E.g-T.g,b:E.b-T.b,a:E.a-T.a}):n=m-T;A.attrs[C][this._id][g]={start:T,diff:n,end:m,trueEnd:x,trueStart:c},A.tweens[C][g]=this._id}_tweenFunc(g){var m=this.node,S=A.attrs[m._id][this._id],C,T,n,h,f,y,x,c;for(C in S){if(T=S[C],n=T.start,h=T.diff,c=T.end,t.Util._isArray(n))if(f=[],x=Math.max(n.length,c.length),C.indexOf("fill")===0)for(y=0;y<x;y++)y%2===0?f.push((n[y]||0)+h[y]*g):f.push("rgba("+Math.round(n[y].r+h[y].r*g)+","+Math.round(n[y].g+h[y].g*g)+","+Math.round(n[y].b+h[y].b*g)+","+(n[y].a+h[y].a*g)+")");else for(y=0;y<x;y++)f.push((n[y]||0)+h[y]*g);else b.indexOf(C)!==-1?f="rgba("+Math.round(n.r+h.r*g)+","+Math.round(n.g+h.g*g)+","+Math.round(n.b+h.b*g)+","+(n.a+h.a*g)+")":f=n+h*g;m.setAttr(C,f)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var g=this.node,m=A.attrs[g._id][this._id];m.points&&m.points.trueEnd&&g.setAttr("points",m.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var g=this.node,m=A.attrs[g._id][this._id];m.points&&m.points.trueStart&&g.points(m.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(g){return this.tween.seek(g*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var g=this.node._id,m=this._id,S=A.tweens[g],C;this.pause();for(C in S)delete A.tweens[g][C];delete A.attrs[g][m]}}s.Tween=A,A.attrs={},A.tweens={},i.Node.prototype.to=function(p){var g=p.onFinish;p.node=this,p.onFinish=function(){this.destroy(),g&&g()};var m=new A(p);m.play()},s.Easings={BackEaseIn(p,g,m,S){var C=1.70158;return m*(p/=S)*p*((C+1)*p-C)+g},BackEaseOut(p,g,m,S){var C=1.70158;return m*((p=p/S-1)*p*((C+1)*p+C)+1)+g},BackEaseInOut(p,g,m,S){var C=1.70158;return(p/=S/2)<1?m/2*(p*p*(((C*=1.525)+1)*p-C))+g:m/2*((p-=2)*p*(((C*=1.525)+1)*p+C)+2)+g},ElasticEaseIn(p,g,m,S,C,T){var n=0;return p===0?g:(p/=S)===1?g+m:(T||(T=S*.3),!C||C<Math.abs(m)?(C=m,n=T/4):n=T/(2*Math.PI)*Math.asin(m/C),-(C*Math.pow(2,10*(p-=1))*Math.sin((p*S-n)*(2*Math.PI)/T))+g)},ElasticEaseOut(p,g,m,S,C,T){var n=0;return p===0?g:(p/=S)===1?g+m:(T||(T=S*.3),!C||C<Math.abs(m)?(C=m,n=T/4):n=T/(2*Math.PI)*Math.asin(m/C),C*Math.pow(2,-10*p)*Math.sin((p*S-n)*(2*Math.PI)/T)+m+g)},ElasticEaseInOut(p,g,m,S,C,T){var n=0;return p===0?g:(p/=S/2)===2?g+m:(T||(T=S*(.3*1.5)),!C||C<Math.abs(m)?(C=m,n=T/4):n=T/(2*Math.PI)*Math.asin(m/C),p<1?-.5*(C*Math.pow(2,10*(p-=1))*Math.sin((p*S-n)*(2*Math.PI)/T))+g:C*Math.pow(2,-10*(p-=1))*Math.sin((p*S-n)*(2*Math.PI)/T)*.5+m+g)},BounceEaseOut(p,g,m,S){return(p/=S)<1/2.75?m*(7.5625*p*p)+g:p<2/2.75?m*(7.5625*(p-=1.5/2.75)*p+.75)+g:p<2.5/2.75?m*(7.5625*(p-=2.25/2.75)*p+.9375)+g:m*(7.5625*(p-=2.625/2.75)*p+.984375)+g},BounceEaseIn(p,g,m,S){return m-s.Easings.BounceEaseOut(S-p,0,m,S)+g},BounceEaseInOut(p,g,m,S){return p<S/2?s.Easings.BounceEaseIn(p*2,0,m,S)*.5+g:s.Easings.BounceEaseOut(p*2-S,0,m,S)*.5+m*.5+g},EaseIn(p,g,m,S){return m*(p/=S)*p+g},EaseOut(p,g,m,S){return-m*(p/=S)*(p-2)+g},EaseInOut(p,g,m,S){return(p/=S/2)<1?m/2*p*p+g:-m/2*(--p*(p-2)-1)+g},StrongEaseIn(p,g,m,S){return m*(p/=S)*p*p*p*p+g},StrongEaseOut(p,g,m,S){return m*((p=p/S-1)*p*p*p*p+1)+g},StrongEaseInOut(p,g,m,S){return(p/=S/2)<1?m/2*p*p*p*p*p+g:m/2*((p-=2)*p*p*p*p+2)+g},Linear(p,g,m,S){return m*p/S+g}}})(Ke);(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Konva=void 0;const t=z,e=tt,i=St,r=Tt,a=Me,o=Mt,l=Zt,u=Qt,v=qt,b=Gt,R=Bt,A=Ke,p=pt,g=ht;s.Konva=e.Util._assign(t.Konva,{Util:e.Util,Transform:e.Transform,Node:i.Node,Container:r.Container,Stage:a.Stage,stages:a.stages,Layer:o.Layer,FastLayer:l.FastLayer,Group:u.Group,DD:v.DD,Shape:b.Shape,shapes:b.shapes,Animation:R.Animation,Tween:A.Tween,Easings:A.Easings,Context:p.Context,Canvas:g.Canvas}),s.default=s.Konva})(le);(function(s,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;var e=le;Object.defineProperty(t,"Konva",{enumerable:!0,get:function(){return e.Konva}});const i=le;s.exports=i.Konva})(he,he.exports);var $i=he.exports;const Tr=qe($i);var me={};Object.defineProperty(me,"__esModule",{value:!0});var qi=me.Rect=void 0;const Ji=dt,Zi=Gt,Qi=z,tr=tt,er=N;class te extends Zi.Shape{_sceneFunc(t){var e=this.cornerRadius(),i=this.width(),r=this.height();t.beginPath(),e?tr.Util.drawRoundedRectPath(t,i,r,e):t.rect(0,0,i,r),t.closePath(),t.fillStrokeShape(this)}}qi=me.Rect=te;te.prototype.className="Rect";(0,Qi._registerNode)(te);Ji.Factory.addGetterSetter(te,"cornerRadius",0,(0,er.getNumberOrArrayOfNumbersValidator)(4));var ye={};Object.defineProperty(ye,"__esModule",{value:!0});var ir=ye.Line=void 0;const ee=dt,rr=Gt,Ye=N,ar=z;function ue(s,t,e,i,r,a,o){var l=Math.sqrt(Math.pow(e-s,2)+Math.pow(i-t,2)),u=Math.sqrt(Math.pow(r-e,2)+Math.pow(a-i,2)),v=o*l/(l+u),b=o*u/(l+u),R=e-v*(r-s),A=i-v*(a-t),p=e+b*(r-s),g=i+b*(a-t);return[R,A,p,g]}function Re(s,t){var e=s.length,i=[],r,a;for(r=2;r<e-2;r+=2)a=ue(s[r-2],s[r-1],s[r],s[r+1],s[r+2],s[r+3],t),!isNaN(a[0])&&(i.push(a[0]),i.push(a[1]),i.push(s[r]),i.push(s[r+1]),i.push(a[2]),i.push(a[3]));return i}class bt extends rr.Shape{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){var e=this.points(),i=e.length,r=this.tension(),a=this.closed(),o=this.bezier(),l,u,v;if(i){if(t.beginPath(),t.moveTo(e[0],e[1]),r!==0&&i>4){for(l=this.getTensionPoints(),u=l.length,v=a?0:4,a||t.quadraticCurveTo(l[0],l[1],l[2],l[3]);v<u-2;)t.bezierCurveTo(l[v++],l[v++],l[v++],l[v++],l[v++],l[v++]);a||t.quadraticCurveTo(l[u-2],l[u-1],e[i-2],e[i-1])}else if(o)for(v=2;v<i;)t.bezierCurveTo(e[v++],e[v++],e[v++],e[v++],e[v++],e[v++]);else for(v=2;v<i;v+=2)t.lineTo(e[v],e[v+1]);a?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():Re(this.points(),this.tension())}_getTensionPointsClosed(){var t=this.points(),e=t.length,i=this.tension(),r=ue(t[e-2],t[e-1],t[0],t[1],t[2],t[3],i),a=ue(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],i),o=Re(t,i),l=[r[2],r[3]].concat(o).concat([a[0],a[1],t[e-2],t[e-1],a[2],a[3],r[0],r[1],t[0],t[1]]);return l}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};this.tension()!==0?t=[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:t=this.points();for(var e=t[0],i=t[0],r=t[1],a=t[1],o,l,u=0;u<t.length/2;u++)o=t[u*2],l=t[u*2+1],e=Math.min(e,o),i=Math.max(i,o),r=Math.min(r,l),a=Math.max(a,l);return{x:e,y:r,width:i-e,height:a-r}}}ir=ye.Line=bt;bt.prototype.className="Line";bt.prototype._attrsAffectingSize=["points","bezier","tension"];(0,ar._registerNode)(bt);ee.Factory.addGetterSetter(bt,"closed",!1);ee.Factory.addGetterSetter(bt,"bezier",!1);ee.Factory.addGetterSetter(bt,"tension",0,(0,Ye.getNumberValidator)());ee.Factory.addGetterSetter(bt,"points",[],(0,Ye.getNumberArrayValidator)());var Nt={};Object.defineProperty(Nt,"__esModule",{value:!0});var nr=Nt.Text=Nt.stringToArray=void 0;const fe=tt,rt=dt,sr=Gt,wt=N,or=z;function Xe(s){return Array.from(s)}Nt.stringToArray=Xe;var Dt="auto",hr="center",We="inherit",Lt="justify",lr="Change.konva",dr="2d",Ge="-",ze="left",cr="text",ur="Text",fr="top",gr="bottom",Oe="middle",je="normal",pr="px ",Kt=" ",vr="right",Fe="rtl",_r="word",mr="char",Le="none",se="…",$e=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],yr=$e.length;function Cr(s){return s.split(",").map(t=>{t=t.trim();const e=t.indexOf(" ")>=0,i=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!i&&(t=`"${t}"`),t}).join(", ")}var Yt;function oe(){return Yt||(Yt=fe.Util.createCanvasElement().getContext(dr),Yt)}function Sr(s){s.fillText(this._partialText,this._partialTextX,this._partialTextY)}function br(s){s.setAttr("miterLimit",2),s.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function wr(s){return s=s||{},!s.fillLinearGradientColorStops&&!s.fillRadialGradientColorStops&&!s.fillPatternImage&&(s.fill=s.fill||"black"),s}class X extends sr.Shape{constructor(t){super(wr(t)),this._partialTextX=0,this._partialTextY=0;for(var e=0;e<yr;e++)this.on($e[e]+lr,this._setTextData);this._setTextData()}_sceneFunc(t){var e=this.textArr,i=e.length;if(this.text()){var r=this.padding(),a=this.fontSize(),o=this.lineHeight()*a,l=this.verticalAlign(),u=this.direction(),v=0,b=this.align(),R=this.getWidth(),A=this.letterSpacing(),p=this.fill(),g=this.textDecoration(),m=g.indexOf("underline")!==-1,S=g.indexOf("line-through")!==-1,C;u=u===We?t.direction:u;var T=0,T=o/2,n=0,h=0;for(u===Fe&&t.setAttr("direction",u),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",Oe),t.setAttr("textAlign",ze),l===Oe?v=(this.getHeight()-i*o-r*2)/2:l===gr&&(v=this.getHeight()-i*o-r*2),t.translate(r,v+r),C=0;C<i;C++){var n=0,h=0,f=e[C],y=f.text,x=f.width,c=f.lastInParagraph,E,_,P;if(t.save(),b===vr?n+=R-x-r*2:b===hr&&(n+=(R-x-r*2)/2),m){t.save(),t.beginPath(),t.moveTo(n,T+h+Math.round(a/2)),E=y.split(" ").length-1,_=E===0,P=b===Lt&&!c?R-r*2:x,t.lineTo(n+Math.round(P),T+h+Math.round(a/2)),t.lineWidth=a/15;const K=this._getLinearGradient();t.strokeStyle=K||p,t.stroke(),t.restore()}if(S){t.save(),t.beginPath(),t.moveTo(n,T+h),E=y.split(" ").length-1,_=E===0,P=b===Lt&&c&&!_?R-r*2:x,t.lineTo(n+Math.round(P),T+h),t.lineWidth=a/15;const K=this._getLinearGradient();t.strokeStyle=K||p,t.stroke(),t.restore()}if(u!==Fe&&(A!==0||b===Lt)){E=y.split(" ").length-1;for(var G=Xe(y),k=0;k<G.length;k++){var L=G[k];L===" "&&!c&&b===Lt&&(n+=(R-r*2-x)/E),this._partialTextX=n,this._partialTextY=T+h,this._partialText=L,t.fillStrokeShape(this),n+=this.measureSize(L).width+A}}else A!==0&&t.setAttr("letterSpacing",`${A}px`),this._partialTextX=n,this._partialTextY=T+h,this._partialText=y,t.fillStrokeShape(this);t.restore(),i>1&&(T+=o)}}}_hitFunc(t){var e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}setText(t){var e=fe.Util._isString(t)?t:t==null?"":t+"";return this._setAttr(cr,e),this}getWidth(){var t=this.attrs.width===Dt||this.attrs.width===void 0;return t?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var t=this.attrs.height===Dt||this.attrs.height===void 0;return t?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return fe.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e=oe(),i=this.fontSize(),r;return e.save(),e.font=this._getContextFont(),r=e.measureText(t),e.restore(),{width:r.width,height:i}}_getContextFont(){return this.fontStyle()+Kt+this.fontVariant()+Kt+(this.fontSize()+pr)+Cr(this.fontFamily())}_addTextLine(t){this.align()===Lt&&(t=t.trim());var i=this._getTextWidth(t);return this.textArr.push({text:t,width:i,lastInParagraph:!1})}_getTextWidth(t){var e=this.letterSpacing(),i=t.length;return oe().measureText(t).width+(i?e*(i-1):0)}_setTextData(){var t=this.text().split(`
`),e=+this.fontSize(),i=0,r=this.lineHeight()*e,a=this.attrs.width,o=this.attrs.height,l=a!==Dt&&a!==void 0,u=o!==Dt&&o!==void 0,v=this.padding(),b=a-v*2,R=o-v*2,A=0,p=this.wrap(),g=p!==Le,m=p!==mr&&g,S=this.ellipsis();this.textArr=[],oe().font=this._getContextFont();for(var C=S?this._getTextWidth(se):0,T=0,n=t.length;T<n;++T){var h=t[T],f=this._getTextWidth(h);if(l&&f>b)for(;h.length>0;){for(var y=0,x=h.length,c="",E=0;y<x;){var _=y+x>>>1,P=h.slice(0,_+1),G=this._getTextWidth(P)+C;G<=b?(y=_+1,c=P,E=G):x=_}if(c){if(m){var k,L=h[c.length],O=L===Kt||L===Ge;O&&E<=b?k=c.length:k=Math.max(c.lastIndexOf(Kt),c.lastIndexOf(Ge))+1,k>0&&(y=k,c=c.slice(0,y),E=this._getTextWidth(c))}c=c.trimRight(),this._addTextLine(c),i=Math.max(i,E),A+=r;var et=this._shouldHandleEllipsis(A);if(et){this._tryToAddEllipsisToLastLine();break}if(h=h.slice(y),h=h.trimLeft(),h.length>0&&(f=this._getTextWidth(h),f<=b)){this._addTextLine(h),A+=r,i=Math.max(i,f);break}}else break}else this._addTextLine(h),A+=r,i=Math.max(i,f),this._shouldHandleEllipsis(A)&&T<n-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),u&&A+r>R)break}this.textHeight=e,this.textWidth=i}_shouldHandleEllipsis(t){var e=+this.fontSize(),i=this.lineHeight()*e,r=this.attrs.height,a=r!==Dt&&r!==void 0,o=this.padding(),l=r-o*2,u=this.wrap(),v=u!==Le;return!v||a&&t+i>l}_tryToAddEllipsisToLastLine(){var t=this.attrs.width,e=t!==Dt&&t!==void 0,i=this.padding(),r=t-i*2,a=this.ellipsis(),o=this.textArr[this.textArr.length-1];if(!(!o||!a)){if(e){var l=this._getTextWidth(o.text+se)<r;l||(o.text=o.text.slice(0,o.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(o.text+se)}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const t=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,e=this.hasShadow();return t&&e?!0:super._useBufferCanvas()}}nr=Nt.Text=X;X.prototype._fillFunc=Sr;X.prototype._strokeFunc=br;X.prototype.className=ur;X.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,or._registerNode)(X);rt.Factory.overWriteSetter(X,"width",(0,wt.getNumberOrAutoValidator)());rt.Factory.overWriteSetter(X,"height",(0,wt.getNumberOrAutoValidator)());rt.Factory.addGetterSetter(X,"direction",We);rt.Factory.addGetterSetter(X,"fontFamily","Arial");rt.Factory.addGetterSetter(X,"fontSize",12,(0,wt.getNumberValidator)());rt.Factory.addGetterSetter(X,"fontStyle",je);rt.Factory.addGetterSetter(X,"fontVariant",je);rt.Factory.addGetterSetter(X,"padding",0,(0,wt.getNumberValidator)());rt.Factory.addGetterSetter(X,"align",ze);rt.Factory.addGetterSetter(X,"verticalAlign",fr);rt.Factory.addGetterSetter(X,"lineHeight",1,(0,wt.getNumberValidator)());rt.Factory.addGetterSetter(X,"wrap",_r);rt.Factory.addGetterSetter(X,"ellipsis",!1,(0,wt.getBooleanValidator)());rt.Factory.addGetterSetter(X,"letterSpacing",0,(0,wt.getNumberValidator)());rt.Factory.addGetterSetter(X,"text","",(0,wt.getStringValidator)());rt.Factory.addGetterSetter(X,"textDecoration","");export{dt as F,z as G,Tr as K,ir as L,qi as R,Gt as S,nr as T,tt as U,N as V};
